<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<th:block layout:fragment="content">
  <style>

      :root {
          --toggle-degree: 135deg;
      }
      .arrow {
          position: relative;
          cursor: pointer;
      }
      .arrow::after {
          position: absolute;
          margin-top: auto;
          left: 0;
          top: 90%;
          content: '';
          width: 10px; /* 사이즈 */
          height: 10px; /* 사이즈 */
          border-top: 2px solid #000; /* 선 두께 */
          border-right: 2px solid #000; /* 선 두께 */
          border-color: inherit;
          transition: all 0.5s;
          transform: rotate(var(--toggle-degree));
      }
      .custom-input-box {
            background-color: #f5f5f5;
            border: none;
            border-radius: 13px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            width: 850px;
            height: 35px;
            padding: 10px;
            border: 3px solid #ccc;
            transition: border-color 0.3s;
            margin: 20px;
        }
      .input-field {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background-color: #f5f5f5;
            outline: none;
            width: 100%;
            height: 95%;
            font-size: 15px;
        }
      .api-button {
            background-image: url('/assets/img/icon/icon-search.png');
            background-position: center;
            background-size: contain;
            background-repeat: no-repeat;
            background-color: transparent;
            background-size: 25px auto;
            padding: 15px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
      .font-bold{
          font-weight: 700;
        }
      .us{
          align-items: center;
          justify-content: left;
          text-align: center;
          font-size: 13px;
        }
      .rankSelect {
          color: gray; /* Lighter color for unselected text */
          cursor: pointer; /* Change cursor to pointer on hover */
        }
      .rankSelect.selected {
          color: white; /* Darker color for selected text */
          font-weight: bold; /* Add bold style to selected text */
        }
      #profileIcon {
          width: 125px;
          height: 125px;
          margin: 5px;
        }
      #emblem{
          width: 125px;
          height: auto;
          margin: 5px;
          margin-right: 10px;
        }
      #summonerName{
          font-size: 35px;
          margin: 5px;
        }
      #summonerLevel{
          font-size: 25px;
          margin: 5px;
        }
      #rank, #tier{
          margin: 5px;
          font-size: 25px;
          justify-content: center;
        }
      #wins, #losses{
          margin: 5px;
          font-size: 20px;
          justify-content: center;
        }
      #rankOptions{
          margin: 6px;
        }
      .winBox{
            background: rgba(49, 142, 239, 0.1);
            border-left: 5px solid rgba(49, 142, 239, 0.6); /* Adjust the width as needed */
            border-radius: 4px;
            display: flex;
            position: relative;
            padding: 10px 18px 10px 18px;
            margin-top: 5px;
            margin-bottom: 5px;
        }
      .lossBox {
            background: rgba(244, 88, 78, 0.1);
            border-left: 5px solid rgba(244, 88, 78, 0.6); /* Adjust the width as needed */
            border-radius: 4px;
            display: flex;
            position: relative;
            padding: 10px 18px 10px 18px;
            margin-top: 5px;
            margin-bottom: 5px;
        }
      .reBox {
          background: #2c2c2f;
          border-left: 5px solid rgba(72, 72, 76, 0.7); /* Adjust the width as needed */
          border-radius: 4px;
          display: flex;
          position: relative;
          padding: 10px 18px 10px 18px;
          margin-top: 5px;
          margin-bottom: 5px;
      }
      .champImgS{
            width: 25px;
            height: 25px;
            border-radius: 50%;
            clip-path: inset(3px);
        }
      .custom-link {
            text-decoration: none; /* 밑줄 제거 */
            color: white; /* 링크 색상 설정 */
            cursor: pointer; /* 커서 스타일 변경 (선택 사항) */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap
        }
      .rune-img {
            width: 25px;
            height: 25px;
            overflow: hidden;
            border-radius: 50%;
            margin-right: 15px;
        }
      .ka-st{
            font-size: 18px;
        }
      .d-st{
            font-size: 18px;
            color: crimson;
        }
      .kda-st{
            font-size: 15px;
            color: gray;
        }
      .detailButton{
          font-size: 15px;
          cursor: pointer;
          margin-top: 10px;
          font-weight: bold;
          color: gray;
      }
      .detailButton.selected{
          color: white;
      }
      .outLineBox{
          background-color: #393a3c;
          border-radius: 5px;
          border-style: none;
          width: 180px;
          height: 120px;
          margin-top: 10px;
          display: flex;
          justify-content: center;
      }
      .olpBox{
          width: 85%;
          display:flex;
          justify-content: space-between
      }
      .detailImg{
          width: 25px;
          height: auto;
          object-fit: cover;
      }
      .detailChampImg{
          width: 25px;
          height: auto;
          margin-right: 3px;
          object-fit: cover;
          clip-path: inset(3px);
      }
      .outlineTtile{
          font-size: 12px;
          margin-left: 10px;
          margin-bottom: 3px;
      }
      .detailValue{
          margin-left: 10px;
          margin-bottom: 8px;
          font-size: 25px;
          font-weight: bold
      }
      .centered-container {
          display: flex;
          justify-content: center;
          align-items: center;
      }
      .gold-coin {
          position: relative;
          width: 15px;
          height: 15px;
          border-radius: 50%;
          background-color: #FFD700; /* Gold color */
          overflow: hidden;
          box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }
      .coin-edge {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border: 2px solid #DAA520; /* Darker gold color for the edge */
          border-radius: 50%;
          box-sizing: border-box;
      }
      .coin-body {
          position: absolute;
          top: 2px;
          left: 2px;
          width: 11px;
          height: 11px;
          border-radius: 50%;
          background-color: #FFD700; /* Gold color */
      }
      .coin-details {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 7px;
          height: 3px;
          background-color: #DAA520; /* Darker gold color for the details */
      }
      .itemBuild{
          width: 100%;
          padding: 10px;
          margin-top: 10px;
          background-color: #2c2c2f;
          border-top-left-radius: 10px;
          border-top-right-radius: 10px;
      }
      .itemDiv{
          width: 100%;
          padding: 10px;
          display:flex;
          flex-wrap: wrap;
          background-color: #31313c;
      }
      .skilldiv{
          width: 100%;
          padding: 10px;
          display:flex;
          flex-wrap: wrap;
      }
      .runeTitle{
          display: flex;
          justify-content: center;
          align-items: center;
          text-align: center;
          font-weight: bold;
      }
      .runeImg{
          width: 30px;
          height: 30px;
          margin-bottom: 7px;
      }
      .spinner {
          border: 3px solid #f3f3f3; /* Light grey */
          border-top: 3px solid #3498db; /* Blue */
          border-radius: 50%;
          width: 20px;
          height: 20px;
          animation: spin 1s linear infinite;
          margin-right: 10px;
      }
      @keyframes spin {
          0% {
              transform: rotate(0deg);
          }
          100% {
              transform: rotate(360deg);
          }
      }
      .centered {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 100%; /* 너비를 100%로 설정하여 화면 가로 전체를 차지 */
      }
      .sideLayout{
          width: 100%;
          height: 100%;
          justify-content: start;
          align-items: center;
      }
      .sideDiv{
          width: 90%;
          align-items: center;
          background-color: #2c2c2f;
          border-radius: 10px;
          padding: 15px;
          margin-top: 5px;
      }
      .sideSelect {
          cursor: pointer;
          font-size: 15px;
          text-align: center;
          border-radius: 8px;
          font-weight: bold;
          width: 100px;
          height: 30px;
          margin-top: 5px;
          line-height: 30px;
      }
      .more{
          width: 100%;
          height: 40px;
          border-width: 1px;
          border-style: solid;
          border-color: #4d5154;
          background-color: #31313c;
          border-radius: 5px;
          display: none;
          font-weight: bold;
          color: white;
          text-align: center;
      }

  </style>

  <div class="main-box bg-dark">
    <main class="main-box2">
        <div>
            <label class="custom-input-box">
                <input type="text" id="inputValue" class="input-field" placeholder="라이엇 ID와 태그를 입력해주세요. ( ex. hide on bush #kr1 )" onkeydown="handleEnterKey(event)" onclick="highlightInput()">
                <button onclick="callApi()" class="api-button" style=""></button>
            </label>
        </div>
        <div id="errorAppend" class="row-lo" style="display:flex; justify-content: space-between; width: 100%; margin-top: 20px">
          <div class="row-lo">
            <div id="profileIcon"></div>
            <div>
              <div class="font-bold" id="summonerName"></div>
              <div class="font-bold" id="summonerLevel"></div>
            </div>
          </div>
          <div class="spinner" id="sp1"></div>
          <div class="row-lo">
              <div style="height: 100%;">
                <div class="row-lo" id="emblem"></div>
              </div>
              <div class="column-lo">
                <div class="row-lo us rankSelect" id="rankOptions">
                  <div class="us rankSelect" id="soloRank">솔로랭크</div>
                  <div>&nbsp;&nbsp;|&nbsp;&nbsp;</div>
                  <div class="us rankSelect" id="flexRank">자유랭크</div>
                </div>
                <div class="row-lo" style="min-width: 200px">
                  <div id="tier"></div>
                  <div id="rank"></div>
                </div>
                <div class="row-lo">
                  <div id="wins"></div>
                  <div id="losses"></div>
                </div>
              </div>
          </div>
      </div>
        <div class="row-lo" style="width: 100%; display: flex; justify-content: space-between; margin-top: 15px;">
            <div class="column-lo" id="most-info" style="width: 360px; display: flex;justify-content: center;align-items: center;"><div class="spinner" id="sp3"></div></div>
            <div class="column-lo" id="match-history" style="min-width: 730px; display: flex;justify-content: center;align-items: center;">
                <button id="more" class="more" onclick="secondFunction(matchIndex)">더 보기</button>
                <div class="spinner" id="sp2"></div>
            </div>
        </div>

    </main>


  </div>

  <script>

    let matchIndex = 0;
    //솔로, 자유 랭크 리스트
    const ranks = [
      { rank: ".", tier: ".", wins: 0, losses: 0 },
      { rank: ".", tier: ".", wins: 0, losses: 0 }
    ];


    // 응답 데이터를 화면에 출력
    const summonerNameElement = document.getElementById("summonerName");
    const profileIconElement = document.getElementById("profileIcon");
    const summonerLevelElement = document.getElementById("summonerLevel");
    const rankElement = document.getElementById("rank");
    const tierElement = document.getElementById("tier");
    const winsElement = document.getElementById("wins");
    const lossesElement = document.getElementById("losses");
    const emblemElement = document.getElementById("emblem")
    const rankOptions = document.getElementById("rankOptions");
    const soloRank = document.getElementById("soloRank");
    const flexRank = document.getElementById("flexRank");
    const matchHistoryContainer = document.getElementById('more');
    const errorAppend = document.getElementById('errorAppend');
    const sideInfoContainer = document.getElementById('most-info');

    let targetId;

    const matchData = [
        // 여기에 JSON 데이터 추가
    ];

    const userId = [];

    // 페이지가 로드되면 실행되는 함수
    document.addEventListener("DOMContentLoaded", function() {

      // 첫 번째 함수 실행, 소환사 기본 정보 생성
      function firstFunction() {
        sds("sp1");
        // URL에서 summonerName 쿼리 파라미터 값을 가져옴
        var summonerNameParam = new URLSearchParams(window.location.search).get("summonerName");
        // summonerName 요소가 존재하는지 확인
        if (summonerNameParam) {
          var userApiUrl = apiUrl + "/user"; // URL 파라미터를 제외한 URL

          fetch(userApiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ summonerName: summonerNameParam }) // 요청 데이터를 JSON 형식으로 전달
          })
                  .then(response => response.json())
                  .then(data => {
                    userId.push(data.id);
                    summonerNameElement.textContent = data.summonerName;
                    profileIconElement.innerHTML = "<img loading='lazy' decoding='async' src='http://ddragon.leagueoflegends.com/cdn/"+version+"/img/profileicon/" + data.profileIcon + ".png' alt='Profile Icon' style='width: 100%; height: 100%; object-fit: cover; border-radius: 10px;'>";
                    summonerLevelElement.textContent = data.summonerLevel;

                    ranks[0].rank = data.ranks[0].rank;
                    ranks[0].tier = data.ranks[0].tier;
                    ranks[0].wins = data.ranks[0].wins;
                    ranks[0].losses = data.ranks[0].losses

                    ranks[1].rank = data.ranks[1].rank;
                    ranks[1].tier = data.ranks[1].tier;
                    ranks[1].wins = data.ranks[1].wins;
                    ranks[1].losses = data.ranks[1].losses

                    emblemElement.innerHTML = "<img loading='lazy' decoding='async' src=\"assets/img/emblem/"+ranks[0].tier+".png\" style='width: 100%; height: auto; object-fit: cover; border-radius: 10px;'>";
                    rankElement.textContent = data.ranks[0].rank;
                    tierElement.textContent = data.ranks[0].tier;
                    winsElement.textContent = data.ranks[0].wins+"승 ";
                    lossesElement.textContent = data.ranks[0].losses+"패";
                    hds("sp1");
                  })
                  .catch(error => {
                      generateEmpty();
                      console.log("소환사 정보 없음")
                  });
        }
      }
      firstFunction();

      secondFunction();

      // 세 번째 함수 실행, 숙련도 리스트 생성
      async function thirdFunction() {
          sds("sp3");

          // URL에서 summonerName 쿼리 파라미터 값을 가져옴
          var summonerNameParam = new URLSearchParams(window.location.search).get("summonerName");
          await generateSideContainer(summonerNameParam);
          hds("sp3");
        }
      thirdFunction();
    });

    soloRank.classList.add("selected");

    // Event listeners
    soloRank.addEventListener("click", () => {
      updateRankDisplay(ranks[0]);
      soloRank.classList.add("selected");
      flexRank.classList.remove("selected");
    });
    flexRank.addEventListener("click", () => {
      updateRankDisplay(ranks[1]);
      flexRank.classList.add("selected");
      soloRank.classList.remove("selected");
    });


    //에러 페이지 생성
    async function generateEmpty() {

        hds("sp1");
        hds("sp2");
        hds("sp3");
        const matchElement = document.createElement('div');

        matchElement.innerHTML = `
            <div class="column-lo" style="text-align: center; align-items: center; display: flex;">
            <img loading='lazy' decoding='async' src="assets/img/icon/error.png" style='width: 250px; height: auto;'>
            <h2>존재 하지 않는 소환사 정보 입니다!</h2>
            <h3>오탈자를 확인 후 재검색해주세요.</h3>
            </div>

        `;
        errorAppend.after(matchElement);

    }
    // 두 번째 함수 실행, 전적 리스트 생성
    async function secondFunction() {
        document.getElementById("more").style.display = "none";
        sds("sp2");

        await callMatchHistory();

        await generateMatchHistory(0);
        hds("sp2");

        if (matchIndex < 3){
            document.getElementById("more").style.display='block';
            matchIndex += 1;
        }
    }
    async function generateMatchHistory() {
        const fragment = document.createDocumentFragment();

        for (let i = 0; i < 10; i++) {
            const match = matchData[matchIndex * 10 + i];
            const matchElement = await createMatchElement(match);
            fragment.appendChild(matchElement);
        }

        matchHistoryContainer.before(fragment);
    }
    //전적 리스트 생성
    async function createMatchElement(match) {
        const matchElement = document.createElement('div');
        // gameCreation 값 변환 (에포크 시간 -> 날짜와 시간)
        const gameCreationDate = new Date(match.info.gameCreation);
        const month = gameCreationDate.getMonth() + 1; // 월은 0부터 시작하므로 1을 더해줍니다
        const day = gameCreationDate.getDate();
        const min = Math.floor(match.info.gameDuration / 60);
        const sec = match.info.gameDuration % 60;
        var summonerNameParam = new URLSearchParams(window.location.search).get("summonerName");


        let targetWin;
        // 특정 닉네임의 win 값을 가져오기
        const targetParticipant = findParticipantBySummonerId(userId[0], match.info.participants);
        targetId = targetParticipant.teamId;
        if (targetParticipant.gameEndedInEarlySurrender){
            targetWin = '다시하기'
        }else {
            targetWin = targetParticipant
                ? match.info.teams[targetParticipant.teamId === 100 ? 0 : 1].win ? '승리' : '패배'
                : null;
        }


        matchElement.innerHTML = `
    <div id="B${match.metadata.matchId}" style="width: 100%;" class="${targetWin === '다시하기' ? 'reBox' : (targetWin === '승리' ? 'winBox' : 'lossBox')}">
      <div class="row-lo" style="width: 100%; justify-content: space-between;">
          <div class="row-lo">
            <!--게임 정보-->
            <div class="column-lo" style="margin: 5px; margin-right: 15px; min-width: 70px;">
              <div style="font-weight: bold">${match.info.gameMode}</div>
              <div style="color: lightgray; font-size: 13px">${month}월 ${day}일</div>
              <div style="margin-top: 20px; font-weight: bold; color: ${targetWin === '다시하기' ? 'grey' : (targetWin === '승리' ? 'skyblue' : 'orangered')}">${targetWin}</div>
              <div style="color: lightgray; font-size: 13px;">${min}분 ${sec}초</div>
            </div>
            <div class="column-lo" style="margin-right: 15px; min-width:380px">
              <div class="row-lo" style="min-width: 350px; display: flex; justify-content: space-between;">
                    <div class="row-lo" style="max-width: 220px;">
                        <!--챔피언 초상화/레벨 부분-->
                        <div class="row-lo" style="position: relative">
                              <div style="position: absolute; right: 0; bottom: 0; z-index: 1;">
                                <div style="display: inline-block; background-color: black; border-radius: 50%; text-align: center; padding: 5px; width: 25px; height: 25px; font-size: 13px; font-weight: bold;">${targetParticipant.champLevel}</div>
                              </div>
                              <img loading='lazy' decoding='async' src='assets/img/champion/${targetParticipant.championName}.png' style='width: 70px; height: 70px; overflow: hidden; border-radius: 50%; clip-path: inset(3px);'>
                            </div>
                        <div class="row-lo" style="margin: 5px;">
                          <!--스펠 부분-->
                          <div class="column-lo" style="margin: 5px; max-width: 30px">
                            <div><img loading='lazy' decoding='async' src='assets/img/spell/${targetParticipant.summoner1Id}.png' style='width: 25px; height: 25px; overflow: hidden; border-radius: 50%;'></div>
                            <div><img loading='lazy' decoding='async' src='assets/img/spell/${targetParticipant.summoner2Id}.png' style='width: 25px; height: 25px; overflow: hidden; border-radius: 50%;'></div>
                          </div>
                          <!--룬 부분-->
                          <div class="column-lo" style="margin: 5px; max-width: 30px">
                            ${generateRuneInfo(match.info.gameMode,targetParticipant)}
                          </div>
                          <!--KDA 부분-->
                          <div class="column-lo" style="min-width: 80px">
                            <div class="row-lo">
                              <div class="ka-st">${targetParticipant.kills}&nbsp;/&nbsp;</div>
                              <div class="d-st">${targetParticipant.deaths}</div>
                              <div class="ka-st">&nbsp;/&nbsp;${targetParticipant.assists}</div>
                            </div>
                            <div class="row-lo">
                              <div class="kda-st">${((targetParticipant.kills + targetParticipant.assists) / Math.max(targetParticipant.deaths, 1)).toFixed(2)}&nbsp;평점</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    <div class="row-lo">
                         ${generateLine(targetParticipant)}
                        <!--기타 정보 와드/시야점수/cs-->
                        <div class="column-lo" style="min-width: 90px">
                          <div>제어와드 : ${targetParticipant.visionWardsBoughtInGame}</div>
                          <div>시야점수 : ${targetParticipant.visionScore}</div>
                          <div>CS ${(targetParticipant.totalMinionsKilled + targetParticipant.neutralMinionsKilled)} (${((targetParticipant.totalMinionsKilled+targetParticipant.neutralMinionsKilled) / min).toFixed(1)})</div>
                        </div>
                    </div>
              </div>
              <!--아이템 부분-->
              <div class="row-lo" style="margin: 5px; margin-top: 15px; width: 100%; min-width: 350px">
                <div class="row-lo" style="max-width: 220px;">${generateItemInfo(targetParticipant)}</div>
                <div class="row-lo">${generateSlayer(targetParticipant,min)}</div>
              </div>
            </div>

          </div>
          <!--플레이어 정보-->
          <div class="row-lo">
            <div class="row-lo" style="justify-content: space-between; width:100%;">
                <div class="column-lo" style="margin: 5px; font-size: 12px; min-width: 83px; max-width: 83px;">
                    ${generatePlayerInfo1(match)}
                </div>
                <div class="column-lo" style="margin: 5px; font-size: 12px; min-width: 83px; max-width: 83px;">
                    ${generatePlayerInfo2(match)}
                </div>
            </div>

            </div>

      </div>
      ${await generateArrow(targetParticipant,match)}
    </div>
    <div style="position: relative; height: 550px; width: 100%; text-align: center; display: none;" id="sp${match.metadata.matchId}">
        <div class="spinner" style="position: absolute;top: 50%;left: 50%;"></div>
    </div>
  `;

        return matchElement;
    }
    //사이드 정보 창 생성
    async function generateSideContainer(summonerName){

        const sideElement = document.createElement('div');
        sideElement.classList.add("column-lo");
        sideElement.classList.add('sideLayout');

        sideElement.innerHTML = `
            <div class="column-lo" style="width: 100%;align-items: start; justify-content: left;">
                <div class="column-lo sideDiv">
                    <div style="font-size: 17px; font-weight: bold; text-align: left; margin-left: 35px; width: 100%;">숙련도 TOP 10</div>
                    <div style="background: white; width: 90%; height: 1px;margin: 5px;"></div>
                    ${await generateMastery(summonerName)}
                </div>
                <div class="column-lo sideDiv" style="margin-top: 15px;">
                    <div style="font-size: 17px; font-weight: bold; text-align: left; margin-left: 35px; width: 100%;">랭크 정보 (최근 20게임)</div>
                    <div style="background: white; width: 90%; height: 1px;margin: 5px;"></div>
                    ${await generateRating(summonerName)}
                </div>
            </div>
        `;

        sideInfoContainer.appendChild(sideElement)
    }
    //숙련도 리스트 생성
    async function generateMastery(summonerName){
        const mastery = [];
        const data = await callMastery(summonerName);

        for (let i = 0;i<data.length;i++){

            const gameCreationDate = new Date(data[i].lastPlayTime);
            const month = gameCreationDate.getMonth() + 1; // 월은 0부터 시작하므로 1을 더해줍니다
            const day = gameCreationDate.getDate();

            mastery.push(`
                <div class="row-lo" style="width: 90%; height: 55px; align-items: center; justify-content: space-between;">
                    <div class="row-lo">
                        <img loading='lazy' decoding='async' src='assets/img/champion/${data[i].championName}.png' style='width: 45px; height: 45px; overflow: hidden; border-radius: 50%; margin-right: 13px; clip-path: inset(3px);'>
                        <div class="column-lo">
                            <div class="row-lo" style="text-align: center; justify-content: space-between; width:150px;">
                                <div style="font-size: 15px; font-weight: bold;">${data[i].championNameKr}</div>
                                <div>${addCommasToNumber(data[i].championPoints)}점</div>
                            </div>
                            <div style="font-size: 12px; text-align: left;">마지막 플레이 : ${month}월 ${day}일</div>
                        </div>
                    </div>
                    <img loading='lazy' decoding='async' src="assets/img/mastery/lv${data[i].championLevel}.png" style='width: 45px; height: auto;'>
                </div>
            `)
        }

        return mastery.join('');
    }
    //랭크 정보 리스트 생성 - 개발 예정
    async function generateRating(summonerName){
        const rating = [];

        rating.push(`
            <div class="column-lo">
                <div class="row-lo">
                    <div class="sideSelect" style="margin-right: 20px; background-color: #393a3c;" id="soloSide" onclick="toggleSide('soloSide')">솔로랭크</div>
                    <div class="sideSelect" style="color:gray;" id="flexSide" onclick="toggleSide('flexSide')">자유랭크</div>
                </div>
                <div id="soloSideTab">${await generateSoloRating(summonerName)}</div>
                <div id="flexSideTab" style="display: none;">${await generateFlexRating(summonerName)}</div>
            </div>
        `)
        rating.push(`여기는 랭크 전적 정보 란입니다.`)

        return rating.join('');
    }
    async function generateSoloRating(sn){
        const rating = [];/*
        const data = await callSoloRating(sn)
        console.log("solo rating data = ",data);*/
        rating.push("솔로 랭크 요약 탭 / 개발중")

        return rating.join('');
    }
    async function generateFlexRating(sn){
        const rating = [];/*
        const data = await callFlexRating(sn);
        console.log("flex rating data = ",data);*/
        rating.push("자유 랭크 요약 탭 / 개발중")

        return rating.join('');
    }
    //블루팀 플레이어 리스트 생성
    function generatePlayerInfo1(match) {
        const playerInfoHtml = [];
        const maxPlayers = match.info.gameMode === "아레나" ? 4 : 5;

        const arenaMode = match.info.gameMode === "아레나";

        for (let i = 0; i < maxPlayers; i++) {
            const participant = match.info.participants[i];

            if (!participant) {
                break; // Stop if no more participants
            }

            const participantChampionName = participant.championName;
            const participantSummonerName = participant.summonerName;

            const championImg = `<img loading='lazy' decoding='async' src='assets/img/champion/${participantChampionName}.png' class="champImgS">`;

            const participantInfoHtml = `
            <div class="row-lo">
                ${championImg}
                <a class="custom-link" href="/info?summonerName=${participantSummonerName}" target="_blank">
                    ${participantSummonerName}
                </a>
            </div>
        `;

            playerInfoHtml.push(participantInfoHtml);

            if (i === 1 && arenaMode) {
                playerInfoHtml.push('<div style="width: 30px; height: 30px;"></div>');
            }
        }

        return playerInfoHtml.join('');
    }
    //레드팀 플레이어 리스트 생성
    function generatePlayerInfo2(match) {
        const playerInfoHtml = [];
        const startIndex = match.info.gameMode === "아레나" ? 4 : 5;
        const maxPlayers = match.info.gameMode === "아레나" ? 8 : 10;

        const arenaMode = match.info.gameMode === "아레나";

        for (let i = startIndex; i < maxPlayers; i++) {
            const participant = match.info.participants[i];

            if (!participant) {
                break; // Stop if no more participants
            }

            const participantChampionName = participant.championName;
            const participantSummonerName = participant.summonerName;

            const championImg = `<img loading='lazy' decoding='async' src='assets/img/champion/${participantChampionName}.png' class="champImgS">`;

            const participantInfoHtml = `
            <div class="row-lo">
                ${championImg}
                <a class="custom-link" href="/info?summonerName=${participantSummonerName}" target="_blank">
                    ${participantSummonerName}
                </a>
            </div>
        `;

            playerInfoHtml.push(participantInfoHtml);

            if (i === 5 && arenaMode) {
                playerInfoHtml.push('<div style="width: 30px; height: 30px;"></div>');
            }
        }

        return playerInfoHtml.join('');
    }
    //플레이어 킬 리스트 생성
    function generateSlayer(targetParticipant, min) {
        const slayerList = [
            targetParticipant.pentaKills,
            targetParticipant.quadraKills,
            targetParticipant.tripleKills,
            targetParticipant.doubleKills
        ];

        const slayerListLabels = ["펜타킬", "쿼드라킬", "트리플킬", "더블킬"];
        const Slayer = [];

        for (let i = 0; i < 4; i++) {
            if (slayerList[i] > 0) {
                Slayer.push(`<div style="height: 25px; background-color: #b02a37; border-radius: 15px; text-align: center; margin-left: 10px;">
                            &nbsp;&nbsp;${slayerListLabels[i]}&nbsp;&nbsp;
                        </div>`);
                break;
            }
        }

        const farmRate = ((targetParticipant.totalMinionsKilled + targetParticipant.neutralMinionsKilled) / min).toFixed(1);
        if (farmRate > 9.0) {
            Slayer.push(`<div style="height: 25px; background-color: #b02a37; border-radius: 15px; text-align: center; margin-left: 10px;">
                        &nbsp;&nbsp;파밍왕&nbsp;&nbsp;
                    </div>`);
        }

        return Slayer.join('');
    }
    //플레이어 아이템 리스트 생성
    function generateItemInfo(targetParticipant) {
        const itemInfoHtml = [];

        // 아이템 정보를 생성하고 배열에 추가
        for (let i = 0; i < 7; i++) {
            const itemImageId = targetParticipant[`item${i}`];

            // 아이템 ID가 0인 경우에는 빈 칸으로 처리
            if (itemImageId !== 0) {
                const itemImageSrc = `assets/img/item/${itemImageId}.png`;
                itemInfoHtml.push(`
                <img loading='lazy' decoding='async' src='${itemImageSrc}' style='width: 30px; height: 30px; overflow: hidden; border-radius: 50%;'>
            `);
            } else {
                let backgroundColor;
                // 아이템 ID가 0인 경우, 빈 칸 추가
                if (targetParticipant.gameEndedInEarlySurrender){
                    backgroundColor = 'rgba(74, 74, 77, 0.7)'
                }else {
                    backgroundColor = targetParticipant.win ? 'rgba(49, 142, 239, 0.2)' : 'rgba(244, 88, 78, 0.2)';
                }

                itemInfoHtml.push(`
                <div style='width: 30px; height: 30px; border-radius: 50%; background:${backgroundColor};'></div>
            `);
            }
        }

        // 배열에 있는 아이템 정보를 문자열로 변환하여 반환
        return itemInfoHtml.join('');
    }
    //플레이어 룬 정보 리스트 생성
    function generateRuneInfo(gameMode, targetParticipant) {
        const runeInfoHtml = [];

        if (gameMode != "아레나") {
                runeInfoHtml.push(`
                <div><img loading='lazy' decoding='async' src='assets/img/runes/${targetParticipant.perks.styles[0].selections[0].perk}.png' style="width: 25px; height: 25px; overflow: hidden; border-radius: 50%; margin-right: 15px;"></div>
                <div><img loading='lazy' decoding='async' src='assets/img/runes/${targetParticipant.perks.styles[1].style}.png' style="width: 25px; height: 25px; overflow: hidden; border-radius: 50%; margin-right: 15px;"></div>
            `);
            } else {
                // 아이템 ID가 0인 경우, 빈 칸 추가
                const backgroundColor = targetParticipant.win ? 'rgba(49, 142, 239, 0.2)' : 'rgba(244, 88, 78, 0.2)';
                runeInfoHtml.push(`
                <div style='width: 25px; height: 25px; border-radius: 50%; background:${backgroundColor}; margin-right: 15px;'></div>
                <div style='width: 25px; height: 25px; border-radius: 50%; background:${backgroundColor}; margin-right: 15px;'></div>
            `);
            }

        // 배열에 있는 아이템 정보를 문자열로 변환하여 반환
        return runeInfoHtml.join('');
    }
    //격자 생성
    function generateLine(targetParticipant) {
        const lineHtml = [];

            // 아이템 ID가 0인 경우, 빈 칸 추가
            const backgroundColor = targetParticipant.win ? 'rgba(49, 142, 239, 0.2)' : 'rgba(244, 88, 78, 0.2)';
        lineHtml.push(`
                <div style='width: 1px; height: 75px; background:${backgroundColor}; margin-right: 10px;'></div>
            `);

        // 배열에 있는 아이템 정보를 문자열로 변환하여 반환
        return lineHtml.join('');
    }
    //추가정보 버튼 생성
    async function generateArrow(targetParticipant, match) {
        const tp = encodeURIComponent(JSON.stringify(targetParticipant));
        const arrow = [];
        const backgroundColor = targetParticipant.win ? 'rgba(49, 142, 239, 0.6)' : 'rgba(244, 88, 78, 0.6)';

        arrow.push(`
        <div style="display: flex; margin-left: 10px;" id="${match.metadata.matchId}" onclick="generateDetail('${match.metadata.matchId}', '${tp}');">
            <div class="arrow" style="border-color:${backgroundColor};" ></div>
        </div>
    `);

        // 배열에 있는 플레이어 정보를 문자열로 변환하여 반환
        return arrow.join('');
    }
    //추가정보 생성
    async function generateDetail(matchId,tp) {
        const targetMatch = findMatchById(matchId);
        const result = document.getElementById(matchId);
        const deg = window.getComputedStyle(result, '::after').getPropertyValue('--toggle-degree');

        const parentDetail = document.getElementById('B' + matchId);

        let detail = document.getElementById('D' + matchId);


        if (deg === '135deg') {
            sds(`sp${matchId}`);
            document.getElementById(matchId).style.setProperty('--toggle-degree', '315deg');

            if (!detail) {
                const detailInfo = findHighestStatsPlayer(targetMatch.info);

                detail = document.createElement('div');
                detail.setAttribute('id', 'D' + matchId);
                detail.classList.add('detail-container');
                detail.innerHTML = `
                <div class="row-lo" style="display: flex; justify-content: space-between; width: 100%;">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div class="detailButton selected" id="detailOutline${matchId}" onclick="toggleTab('${matchId}','tabOutline')">개요</div>
                    <div style="font-size: 15px; margin-top: 10px;">|</div>
                    <div class="detailButton" id="detailInfo${matchId}" onclick="toggleTab('${matchId}','tabInfo')">상세</div>
                    <div style="font-size: 15px; margin-top: 10px;">|</div>
                    <div class="detailButton" id="detailBuild${matchId}" onclick="toggleTab('${matchId}','tabBuild')">빌드</div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <div class="tab-content" style="margin-bottom: 15px; max-width: 722px;">
                    <div id="tabOutline${matchId}" class="tab-pane coulmn-lo">
                        <div class="column-lo" style="display: flex; align-items: center; margin-bottom: 15px;">
                            ${generateOutline(detailInfo)}
                        </div>
                    </div>
                    <div id="tabInfo${matchId}" class="tab-pane hidden coulmn-lo">
                        <div class="column-lo" style="margin-bottom: 15px;">
                            ${await generateInfo(matchId)}
                        </div>
                    </div>
                    <div id="tabBuild${matchId}" class="tab-pane hidden coulmn-lo">
                        <div id="${matchId}childtab" class="column-lo" style="display: flex; justify-content: center;align-items: center;">
                            ${await generateBuild(matchId,tp)}
                        </div>
                    </div>
                </div>
            `;
                parentDetail.after(detail);
                hds(`sp${matchId}`);
                // 개요 탭을 보이게 설정
                const tabOutline = document.getElementById('tabOutline' + matchId);
                tabOutline.classList.remove('hidden');
                tabOutline.classList.add('active');
                detail.style.display = 'block';
            }
            else {
                hds(`sp${matchId}`);
                // 숨겨진 탭이 있으면 모두 숨김
                const hiddenTabs = detail.querySelectorAll('.tab-pane.hidden');
                for (const tab of hiddenTabs) {
                    tab.classList.remove('active');
                    tab.classList.add('hidden');
                }
                // 마지막으로 누른 탭을 보이게 설정
                const lastClickedTab = document.querySelector('.tab-pane.active');
                lastClickedTab.classList.remove('hidden');
                lastClickedTab.classList.add('active');

                detail.style.display = 'block';
            }
        }
        else {
            hds(`sp${matchId}`);
            document.getElementById(matchId).style.setProperty('--toggle-degree', '135deg');
            // 현재 전적 리스트의 추가 정보를 숨김
            if (detail) {
                detail.style.display = 'none';
            }
        }
    }
    //개요 생성
    function generateOutline(data) {

        const hsa = Object.values(data);

        const outline = [];

        for (let i =1;i<hsa.length;i++){
            if (hsa[0].mode === "칼바람" && (hsa[i].tag === "시야왕" || hsa[i].tag === "스틸왕" || hsa[i].tag === "와드 학살자")) {
                continue;
            }


            if (i == 1 || i == 4 || i == 7 || i ==10){
                outline.push(`
                <div class="row-lo olpBox">
            `);
            }

            outline.push(`
                <div class="column-lo outLineBox">
                    <div class="outlineTtile">${hsa[i].tag}</div>

            `);

            if (hsa[i].tag =="스틸왕" && hsa[i].value ==0){
                outline.push(`
                        <div class="row-lo" style="width:100%; margin:0px;">
                            <div class="detailValue">No Data</div>
                        </div>
                        <div class="row-lo" style="display: flex; font-size: 12px;margin-top: 10px; margin-left: 10px; justify-content: space-between; min-height: 26.5px">스틸 기록이 없습니다.</div>
                    </div>
                `);
                continue;
            }
            else {
                if (hsa[i].tag =="철거왕"){
                    outline.push(`
                        <div class="row-lo" style="width:100%; margin:0px; justify-content: space-between">
                            <div class="detailValue">${addCommasToNumber(hsa[i].value)}</div>
                            <div class="column-lo" style="margin-right: 10px;">
                                <div style="font-size: 13px; font-weight: bold">포탑 : ${(hsa[i].tk)}</div>
                                <div style="font-size: 13px; font-weight: bold">억제기 : ${(hsa[i].ik)}</div>
                            </div>
                        </div>
                `);
                }
                else if (hsa[i].tag =="시야왕"){
                    outline.push(`
                        <div class="row-lo" style="width:100%; margin:0px; justify-content: space-between;">
                            <div class="detailValue">${addCommasToNumber(hsa[i].value)}</div>
                            <div class="column-lo" style="margin-right: 10px;">
                                <div style="font-size: 15px; font-weight: bold"><img loading='lazy' decoding='async' src="assets/img/icon/VW.png" style='width: 20px; height: auto; object-fit: cover;'> ${(hsa[i].wp)}</div>
                                <div style="font-size: 15px; font-weight: bold"><img loading='lazy' decoding='async' src="assets/img/icon/DW.png" style='width: 20px; height: auto; object-fit: cover;'> ${(hsa[i].dp)}</div>
                            </div>
                        </div>
                `);
                }
                else if (hsa[i].tag =="미니언 학살자"){
                    outline.push(`
                        <div class="row-lo" style="width:100%; margin:0px; justify-content: space-between; align-items: center">
                            <div class="detailValue">${addCommasToNumber(hsa[i].value)}</div>
                            <div style="font-size: 13px; font-weight: bold; margin-right: 10px;">분당 : ${((hsa[i].value)/(hsa[i].min)).toFixed(1)}</div>
                        </div>
                `);
                }
                else {
                    outline.push(`
                        <div class="row-lo" style="width:100%; margin:0px;">
                            <div class="detailValue">${addCommasToNumber(hsa[i].value)}</div>
                        </div>
                `);
                }
            }
            outline.push(`

                    <div class="row-lo" style="display: flex; justify-content: space-between">
                        <div class="row-lo" style="margin-left: 10px">
                            <div><img loading='lazy' decoding='async' src='assets/img/champion/${hsa[i].champion}.png' class="detailChampImg"></div>
                            <div><a class="custom-link" href="/info?summonerName=${hsa[i].playerName}" target="_blank" style="font-size: 13px;">${hsa[i].playerName}</a></div>
                        </div>
                        <div style="margin-right: 10px;"><img loading='lazy' decoding='async' src="assets/img/position/${hsa[i].teamPosition}.png" class="detailImg"></div>
                    </div>
                </div>
            `);


            if (i == 3 || i == 6 || i == 9 || i ==12){
                outline.push(`
                </div>
            `);
            }

        }

        // 배열에 있는 플레이어 정보를 문자열로 변환하여 반환
        return outline.join('');
    }
    //상세 생성
    async function generateInfo(matchId) {
        const info = [];
        const targetMatch = findMatchById(matchId).info;
        const participants = targetMatch.participants
        console.log(participants);
        const targetP = findParticipantBySummonerId(userId[0],participants);
        const teamGold = [0,0];
        const min = Math.floor(targetMatch.gameDuration / 60);

        let dealt = 0;
        let taken = 0;

        for (let i = 0;i<10;i++){
            if (targetMatch.participants[i].totalDamageDealtToChampions > dealt){
                dealt = targetMatch.participants[i].totalDamageDealtToChampions
            }

            if (targetMatch.participants[i].totalDamageTaken > taken){
                taken = targetMatch.participants[i].totalDamageTaken
            }

        }

        for (let i = 0;i<5;i++){
            teamGold[0]+= participants[i].goldEarned;
            teamGold[1]+= participants[i+5].goldEarned;
        }

        const teamRoles = [
            [], // 인덱스 0: 탑
            [], // 인덱스 1: 정글
            [], // 인덱스 2: 미드
            [], // 인덱스 3: 바텀
            [],  // 인덱스 4: 유틸리티
            [] // 인덱스 5: 예외
        ];

        if (targetMatch.gameMode == "칼바람" || targetMatch.gameMode == "특별 모드"){
            // 각 포지션에 플레이어 추가
            for (let i = 0; i < 5; i++) {
                teamRoles[i].push(participants[i]);
                teamRoles[i].push(participants[i + 5]);
            }
        }
        else{
            for (let i = 0; i < participants.length; i++) {
                const teamPosition = participants[i].teamPosition;

                switch (teamPosition) {
                    case 'TOP':
                        teamRoles[0].push(participants[i]);
                        break;
                    case 'JUNGLE':
                        teamRoles[1].push(participants[i]);
                        break;
                    case 'MIDDLE':
                        teamRoles[2].push(participants[i]);
                        break;
                    case 'BOTTOM':
                        teamRoles[3].push(participants[i]);
                        break;
                    case 'UTILITY':
                        teamRoles[4].push(participants[i]);
                        break;
                    default:
                        teamRoles[5].push(participants[i]);
                        // Handle any other cases or invalid values
                        break;
                }
            }
        }

        info.push(`
            <div class="column-lo">
                <div class="row-lo" style="width: 100%;;height: 40px; display: flex; justify-content: space-between; align-items: center; text-align: center">
                    <!--팀-->
                    <div class="row-lo" style="display: flex; justify-content: center; align-items: center; text-align: center;">
                        <div style="font-size: 15px; font-weight: bold; color: ${participants[0].win? 'skyblue' : 'orangered'}">${participants[0].win? "승리":"패배"}</div>
                        <div style="font-size: 13px;">&nbsp;&nbsp;블루팀</div>
                    </div>
                    <!--오브젝트-->
                    <div class="row-lo" style="display: flex; flex-direction: row;">
                        <div class="row-lo">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92046 11L6.98046 10.0533L4.63379 7.70667L5.93356 15.0067H9.91356L11.2138 7.70667L8.86712 10.0533L7.92046 11Z" fill="skyblue"></path><path d="M7.92016 9.84669L12.5068 5.26002H10.3335L11.4202 4.17335L7.92016 0.666687L4.42016 4.17335L5.50683 5.26002H3.3335L7.92016 9.84669ZM7.92016 2.28002L9.62683 3.98669L7.92016 5.69335L6.2135 3.98669L7.92016 2.28002V2.28002Z" fill="skyblue"></path></svg>
                            ${targetMatch.teams[0].objectives.tower.kills}
                        </div>
                        <div class="row-lo" style="margin-left: 3px">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.9998 5.66665L12.6665 1.99998L9.33317 4.99998L7.99984 0.333313L6.6665 4.99998L3.55317 1.99998L3.99984 5.66665H0.666504L3.99984 8.33331V9.48665C3.99984 10.4733 4.3065 11.4333 4.87984 12.2333L6.9465 15.1266C7.1865 15.4666 7.57984 15.6666 7.99984 15.6666C8.41984 15.6666 8.81317 15.4666 9.05317 15.1266L11.1198 12.2333C11.6932 11.4333 11.9998 10.4733 11.9998 9.48665V8.33331L15.3332 5.66665H11.9998ZM7.33317 11.6666L6.33984 11.28C5.89317 11.1066 5.5665 10.72 5.47317 10.2533L4.99984 7.99998L6.21317 9.21331C6.51317 9.51331 6.73984 9.87998 6.87317 10.28L7.33317 11.6666V11.6666ZM9.65984 11.28L8.6665 11.6666L9.1265 10.28C9.25984 9.87998 9.4865 9.51331 9.7865 9.21331L10.9998 7.99998L10.5265 10.2533C10.4265 10.72 10.0998 11.1066 9.65984 11.28V11.28Z" fill="skyblue"></path></svg>
                            ${targetMatch.teams[0].objectives.dragon.kills}
                        </div>
                        <div class="row-lo" style="margin-left: 3px">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.00016 10.0333C8.36835 10.0333 8.66683 9.43635 8.66683 8.69997C8.66683 7.96359 8.36835 7.36664 8.00016 7.36664C7.63197 7.36664 7.3335 7.96359 7.3335 8.69997C7.3335 9.43635 7.63197 10.0333 8.00016 10.0333Z" fill="skyblue"></path><path d="M3.33341 14.0333C3.56008 13.76 3.22007 13.0333 3.02007 12.3267C2.79341 11.5133 2.66674 10.7133 2.44008 10.62C1.78674 10.36 1.10007 11.08 1.02007 11.64C0.913408 12.3667 2.99341 14.44 3.33341 14.0333Z" fill="skyblue"></path><path d="M14 7.36666C14 4.7 11 1.91333 11 1.91333V5.62C10.2667 4.64666 9.19333 4.28 8 4.28C6.80667 4.28 5.73333 4.64666 5 5.62V1.91333C5 1.91333 2 4.7 2 7.36666C2 8.10666 2.06 8.48 2.18 8.7H3.48C3.99333 11.38 6.36667 12.6867 7.99333 12.6867C9.62 12.6867 11.9933 11.3867 12.5067 8.7H13.8067C13.9267 8.48 13.9867 8.10666 13.9867 7.36666H14ZM8 6.03333C9.47333 6.03333 10.6667 7.22666 10.6667 8.7C10.6667 10.1733 8.88 11.3667 8 11.3667C7.12 11.3667 5.33333 10.1733 5.33333 8.7C5.33333 7.22666 6.52667 6.03333 8 6.03333Z" fill="skyblue"></path><path d="M12.6669 14.0333C12.4402 13.76 12.7802 13.0333 12.9802 12.3267C13.2069 11.5133 13.3336 10.7133 13.5602 10.62C14.2136 10.36 14.9002 11.08 14.9802 11.64C15.0869 12.3667 13.0069 14.44 12.6669 14.0333Z" fill="skyblue"></path></svg>
                            ${targetMatch.teams[0].objectives.riftHerald.kills}
                        </div>
                        <div class="row-lo" style="margin-left: 3px">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.3335 1L11.5402 5.33333L11.5002 5.38C10.9735 5.98667 10.2068 6.33333 9.40016 6.33333H9.00016L8.00016 5L7.00016 6.33333H6.6335C5.80683 6.33333 5.02683 5.96667 4.4935 5.33333L7.00016 1L1.3335 4.33333C1.3335 5.19333 1.64016 6.02667 2.20016 6.68L3.1335 8C3.1335 9.52667 3.7335 11.0333 4.4935 12.36L6.00016 15V13.6667H10.0002V15L11.5068 12.36C12.2668 11.0333 12.8668 9.52667 12.8668 8L13.7935 6.68C14.3535 6.02667 14.6602 5.19333 14.6602 4.33333L9.3335 1ZM6.3335 10.6667C5.96683 10.6667 5.66683 10.3667 5.66683 10C5.66683 9.63333 5.96683 9.33333 6.3335 9.33333C6.70016 9.33333 7.00016 9.63333 7.00016 10C7.00016 10.3667 6.70016 10.6667 6.3335 10.6667ZM8.00016 12.3333C7.6335 12.3333 7.3335 12.0333 7.3335 11.6667C7.3335 11.3 7.6335 11 8.00016 11C8.36683 11 8.66683 11.3 8.66683 11.6667C8.66683 12.0333 8.36683 12.3333 8.00016 12.3333ZM8.00016 8.75333C7.6335 8.75333 7.3335 8.45333 7.3335 8.08667C7.3335 7.72 7.6335 7.42 8.00016 7.42C8.36683 7.42 8.66683 7.72 8.66683 8.08667C8.66683 8.45333 8.36683 8.75333 8.00016 8.75333ZM9.66683 10.6667C9.30016 10.6667 9.00016 10.3667 9.00016 10C9.00016 9.63333 9.30016 9.33333 9.66683 9.33333C10.0335 9.33333 10.3335 9.63333 10.3335 10C10.3335 10.3667 10.0335 10.6667 9.66683 10.6667Z" fill="skyblue"></path></svg>
                            ${targetMatch.teams[0].objectives.baron.kills}
                        </div>
                    </div>
                    <!--골드-->
                    <div class="row-lo" style="display: flex; justify-content: center; align-items: center">
                        <div style="margin-right: 2px;">${(teamGold[0] / 1000).toFixed(1)}K</div>
                        <div class="centered-container">
                            <div class="gold-coin">
                                <div class="coin-edge"></div>
                                <div class="coin-body"></div>
                                <div class="coin-details"></div>
                            </div>
                        </div>
                    </div>
                    <!--킬-->
                    <div class="row-lo" style="display: flex; justify-content: center; align-items: center; text-align: center;">
                        <div style="flex: 1; font-size: 20px; font-weight: bold;">${targetMatch.teams[0].objectives.champion.kills}</div>
                        <div style="font-size: 13px;">&nbsp;&nbsp;VS&nbsp;&nbsp;</div>
                        <div style="flex: 1; font-size: 20px; font-weight: bold;">${targetMatch.teams[1].objectives.champion.kills}</div>
                    </div>
                    <!--골드-->
                    <div class="row-lo" style="display: flex; justify-content: center; align-items: center">
                        <div class="centered-container">
                            <div class="gold-coin">
                                <div class="coin-edge"></div>
                                <div class="coin-body"></div>
                                <div class="coin-details"></div>
                            </div>
                        </div>
                        <div style="margin-left: 2px;">${(teamGold[1] / 1000).toFixed(1)}K</div>
                    </div>
                    <!--오브젝트-->
                    <div class="row-lo" style="display: flex; flex-direction: row;">
                        <div class="row-lo">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92046 11L6.98046 10.0533L4.63379 7.70667L5.93356 15.0067H9.91356L11.2138 7.70667L8.86712 10.0533L7.92046 11Z" fill="orangered"></path><path d="M7.92016 9.84669L12.5068 5.26002H10.3335L11.4202 4.17335L7.92016 0.666687L4.42016 4.17335L5.50683 5.26002H3.3335L7.92016 9.84669ZM7.92016 2.28002L9.62683 3.98669L7.92016 5.69335L6.2135 3.98669L7.92016 2.28002V2.28002Z" fill="orangered"></path></svg>
                            ${targetMatch.teams[1].objectives.tower.kills}
                        </div>
                        <div class="row-lo" style="margin-left: 3px">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.9998 5.66665L12.6665 1.99998L9.33317 4.99998L7.99984 0.333313L6.6665 4.99998L3.55317 1.99998L3.99984 5.66665H0.666504L3.99984 8.33331V9.48665C3.99984 10.4733 4.3065 11.4333 4.87984 12.2333L6.9465 15.1266C7.1865 15.4666 7.57984 15.6666 7.99984 15.6666C8.41984 15.6666 8.81317 15.4666 9.05317 15.1266L11.1198 12.2333C11.6932 11.4333 11.9998 10.4733 11.9998 9.48665V8.33331L15.3332 5.66665H11.9998ZM7.33317 11.6666L6.33984 11.28C5.89317 11.1066 5.5665 10.72 5.47317 10.2533L4.99984 7.99998L6.21317 9.21331C6.51317 9.51331 6.73984 9.87998 6.87317 10.28L7.33317 11.6666V11.6666ZM9.65984 11.28L8.6665 11.6666L9.1265 10.28C9.25984 9.87998 9.4865 9.51331 9.7865 9.21331L10.9998 7.99998L10.5265 10.2533C10.4265 10.72 10.0998 11.1066 9.65984 11.28V11.28Z" fill="orangered"></path></svg>
                            ${targetMatch.teams[1].objectives.dragon.kills}
                        </div>
                        <div class="row-lo" style="margin-left: 3px">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.00016 10.0333C8.36835 10.0333 8.66683 9.43635 8.66683 8.69997C8.66683 7.96359 8.36835 7.36664 8.00016 7.36664C7.63197 7.36664 7.3335 7.96359 7.3335 8.69997C7.3335 9.43635 7.63197 10.0333 8.00016 10.0333Z" fill="orangered"></path><path d="M3.33341 14.0333C3.56008 13.76 3.22007 13.0333 3.02007 12.3267C2.79341 11.5133 2.66674 10.7133 2.44008 10.62C1.78674 10.36 1.10007 11.08 1.02007 11.64C0.913408 12.3667 2.99341 14.44 3.33341 14.0333Z" fill="orangered"></path><path d="M14 7.36666C14 4.7 11 1.91333 11 1.91333V5.62C10.2667 4.64666 9.19333 4.28 8 4.28C6.80667 4.28 5.73333 4.64666 5 5.62V1.91333C5 1.91333 2 4.7 2 7.36666C2 8.10666 2.06 8.48 2.18 8.7H3.48C3.99333 11.38 6.36667 12.6867 7.99333 12.6867C9.62 12.6867 11.9933 11.3867 12.5067 8.7H13.8067C13.9267 8.48 13.9867 8.10666 13.9867 7.36666H14ZM8 6.03333C9.47333 6.03333 10.6667 7.22666 10.6667 8.7C10.6667 10.1733 8.88 11.3667 8 11.3667C7.12 11.3667 5.33333 10.1733 5.33333 8.7C5.33333 7.22666 6.52667 6.03333 8 6.03333Z" fill="orangered"></path><path d="M12.6669 14.0333C12.4402 13.76 12.7802 13.0333 12.9802 12.3267C13.2069 11.5133 13.3336 10.7133 13.5602 10.62C14.2136 10.36 14.9002 11.08 14.9802 11.64C15.0869 12.3667 13.0069 14.44 12.6669 14.0333Z" fill="orangered"></path></svg>
                            ${targetMatch.teams[1].objectives.riftHerald.kills}
                        </div>
                        <div class="row-lo" style="margin-left: 3px">
                            <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.3335 1L11.5402 5.33333L11.5002 5.38C10.9735 5.98667 10.2068 6.33333 9.40016 6.33333H9.00016L8.00016 5L7.00016 6.33333H6.6335C5.80683 6.33333 5.02683 5.96667 4.4935 5.33333L7.00016 1L1.3335 4.33333C1.3335 5.19333 1.64016 6.02667 2.20016 6.68L3.1335 8C3.1335 9.52667 3.7335 11.0333 4.4935 12.36L6.00016 15V13.6667H10.0002V15L11.5068 12.36C12.2668 11.0333 12.8668 9.52667 12.8668 8L13.7935 6.68C14.3535 6.02667 14.6602 5.19333 14.6602 4.33333L9.3335 1ZM6.3335 10.6667C5.96683 10.6667 5.66683 10.3667 5.66683 10C5.66683 9.63333 5.96683 9.33333 6.3335 9.33333C6.70016 9.33333 7.00016 9.63333 7.00016 10C7.00016 10.3667 6.70016 10.6667 6.3335 10.6667ZM8.00016 12.3333C7.6335 12.3333 7.3335 12.0333 7.3335 11.6667C7.3335 11.3 7.6335 11 8.00016 11C8.36683 11 8.66683 11.3 8.66683 11.6667C8.66683 12.0333 8.36683 12.3333 8.00016 12.3333ZM8.00016 8.75333C7.6335 8.75333 7.3335 8.45333 7.3335 8.08667C7.3335 7.72 7.6335 7.42 8.00016 7.42C8.36683 7.42 8.66683 7.72 8.66683 8.08667C8.66683 8.45333 8.36683 8.75333 8.00016 8.75333ZM9.66683 10.6667C9.30016 10.6667 9.00016 10.3667 9.00016 10C9.00016 9.63333 9.30016 9.33333 9.66683 9.33333C10.0335 9.33333 10.3335 9.63333 10.3335 10C10.3335 10.3667 10.0335 10.6667 9.66683 10.6667Z" fill="orangered"></path></svg>
                            ${targetMatch.teams[1].objectives.baron.kills}
                        </div>
                    </div>
                    <!--팀-->
                    <div class="row-lo" style="display: flex; justify-content: center; align-items: center; text-align: center;">
                        <div style="font-size: 13px;">레드팀&nbsp;&nbsp;</div>
                        <div style="font-size: 15px; font-weight: bold; color: ${participants[5].win? 'skyblue' : 'orangered'}">${participants[5].win? "승리":"패배"}</div>
                    </div>
                </div>
        `);

        if (teamRoles[5][0] != null){
            for (let i = 0;i<5;i++){
                if (teamRoles[i].length == 1){
                    if (teamRoles[i][0].teamId == 100){
                        teamRoles[i].push(teamRoles[5][0])
                    }else {
                        teamRoles[i].push(teamRoles[i][0])
                        teamRoles[i][0] = teamRoles[5][0]
                    }
                }
            }
        }

        for (let i = 0;i<5;i++){


            const p1 = teamRoles[i][0];
            const p2 = teamRoles[i][1];

            info.push(`
                <div class="row-lo">
                    <div class="row-lo" style="height: 90px; min-width:355px;max-widthwidth: 355px; padding: 4px; display: flex;justify-content: space-between; align-items: center; background-color: rgba(49, 142, 239, 0.1);">
                        <div class="column-lo">
                            <div class="column-lo">
                                <div class="row-lo">
                                    ${generateDetailItem(p1.item0,p1.teamId)}
                                    ${generateDetailItem(p1.item1,p1.teamId)}
                                    ${generateDetailItem(p1.item2,p1.teamId)}
                                    ${generateDetailItem(p1.item6,p1.teamId)}
                                </div>
                                <div class="row-lo">
                                    ${generateDetailItem(p1.item3,p1.teamId)}
                                    ${generateDetailItem(p1.item4,p1.teamId)}
                                    ${generateDetailItem(p1.item5,p1.teamId)}
                                </div>
                            </div>
                        </div>
                        <div class="column-lo" style="min-width: 70px; max-width: 95px; text-align: right;">
                            <div class="row-lo" style="font-size: 13px; text-align: text-align: right; display: flex;justify-content: right;">
                                <div>${p1.kills}</div>
                                <div style="crimson: #b02a37">&nbsp;/&nbsp;${p1.deaths}&nbsp;/&nbsp;</div>
                                <div>${p1.assists}</div>
                            </div>
                            <div style="color: #808080; font-size: 12px">${((p1.kills+p1.assists)/Math.max(p1.deaths,1)).toFixed(2)}</div>
                            <div style="font-size: 13px;">${p1.totalMinionsKilled + p1.neutralMinionsKilled}&nbsp;(${((p1.totalMinionsKilled + p1.neutralMinionsKilled)/min).toFixed(1)})</div>
                        </div>
                        <div class="column-lo" style="min-width: 55px; display: flex; justify-content: right; text-align: right;">
                            <div class="column-lo" style="margin-bottom: 10px;display: flex;justify-content: right;" title="챔피언에게 가한 피해량">
                                <div style="font-size: 12px;">${(p1.totalDamageDealtToChampions/1000).toFixed(1)}K</div>
                                <div style="width: 55px; height: 8px; background-color: #10131c; border-radius: 10px;">
                                    <div style="width: ${((p1.totalDamageDealtToChampions / dealt).toFixed(2)) * 100}%; height: 100%; background-color: #e84057; border-radius: 10px;"></div>
                                </div>
                            </div>
                            <div class="column-lo" style="display: flex;justify-content: right;" title="챔피언에게 받은 피해량">
                                <div style="font-size: 12px;">${(p1.totalDamageTaken/1000).toFixed(1)}K</div>
                                <div style="width: 55px; height: 8px; background-color: #10131c; border-radius: 10px;">
                                    <div style="width: ${((p1.totalDamageTaken / taken).toFixed(2)) * 100}%; height: 100%; background-color: dimgray; border-radius: 10px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="column-lo" style="min-width: 100px;">
                            <div class="row-lo" style="display: flex; align-items: center; justify-content: right">
                                <div class="row-lo">
                                    <div class="column-lo">
                                        <img loading='lazy' decoding='async' src='assets/img/runes/${p1.perks.styles[0].selections[0].perk}.png' style="width: 20px; height: 20px; overflow: hidden; border-radius: 50%;">
                                        <img loading='lazy' decoding='async' src='assets/img/runes/${p1.perks.styles[1].style}.png' style="width: 20px; height: 20px; overflow: hidden; border-radius: 50%;">
                                    </div>
                                    <div class="column-lo">
                                        <img loading='lazy' decoding='async' src='assets/img/spell/${p1.summoner1Id}.png' style='width: 20px; height: 20px; overflow: hidden; border-radius: 50%;'>
                                        <img loading='lazy' decoding='async' src='assets/img/spell/${p1.summoner2Id}.png' style='width: 20px; height: 20px; overflow: hidden; border-radius: 50%;'>
                                    </div>
                                </div>
                                <div class="row-lo" style="position: relative; width: 45px; height: 45px">
                                    <img loading='lazy' decoding='async' src='assets/img/champion/${p1.championName}.png' style='width: 45px; height: 45px; overflow: hidden; border-radius: 50%; clip-path: inset(3px);'>
                                    <div style="position: absolute; width: 15px;height: 15px; right: 0; bottom: 0; z-index: 1;">
                                        <div style="background-color: black; border-radius: 50%; width: 15px; text-align: center; height: 15px; font-size: 10px; font-weight: bold;">${participants[i].champLevel}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="column-lo" style="text-align: right">
                                <div style="font-size: 11px;">${p1.summonerName}</div>
                                <div style="font-size: 9px">Level&nbsp;${p1.summonerLevel}</div>
                            </div>
                        </div>
                    </div>

                    <div class="column-lo" style="min-width: 14px; max-width: 14px; background: linear-gradient(to right, rgba(49, 142, 239, 0.1), rgba(244, 88, 78, 0.1));">

                    </div>
                    <div class="row-lo" style="height: 90px; min-width:355px;max-widthwidth: 355px; padding: 4px; display: flex;justify-content: space-between; align-items: center; background-color: rgba(244, 88, 78, 0.1);">
                        <div class="column-lo" style="min-width: 100px;">
                            <div class="row-lo" style="display: flex; align-items: center; justify-content: left">
                                <div class="row-lo" style="position: relative; width: 45px; height: 45px">
                                    <img loading='lazy' decoding='async' src='assets/img/champion/${p2.championName}.png' style='width: 45px; height: 45px; overflow: hidden; border-radius: 50%; clip-path: inset(3px);'>
                                    <div style="position: absolute;width: 15px;height: 15px; left: 0; bottom: 0; z-index: 1;">
                                        <div style="background-color: black; border-radius: 50%; width: 15px; text-align: center; height: 15px; font-size: 10px; font-weight: bold;">${participants[i].champLevel}</div>
                                    </div>
                                </div>
                                <div class="row-lo">
                                    <div class="column-lo">
                                        <img loading='lazy' decoding='async' src='assets/img/spell/${p2.summoner1Id}.png' style='width: 20px; height: 20px; overflow: hidden; border-radius: 50%;'>
                                        <img loading='lazy' decoding='async' src='assets/img/spell/${p2.summoner2Id}.png' style='width: 20px; height: 20px; overflow: hidden; border-radius: 50%;'>
                                    </div>
                                    <div class="column-lo">
                                        <img loading='lazy' decoding='async' src='assets/img/runes/${p2.perks.styles[0].selections[0].perk}.png' style="width: 20px; height: 20px; overflow: hidden; border-radius: 50%;">
                                        <img loading='lazy' decoding='async' src='assets/img/runes/${p2.perks.styles[1].style}.png' style="width: 20px; height: 20px; overflow: hidden; border-radius: 50%;">
                                    </div>
                                </div>
                            </div>
                            <div class="column-lo" style="text-align: left;">
                                <div style="font-size: 11px;">${p2.summonerName}</div>
                                <div style="font-size: 9px">Level&nbsp;${p2.summonerLevel}</div>
                            </div>
                        </div>
                        <div class="column-lo" style="min-width: 55px; display: flex; justify-content: left;">
                            <div class="column-lo" style="margin-bottom: 10px" title="챔피언에게 가한 피해량">
                                <div style="font-size: 12px;">${(p2.totalDamageDealtToChampions/1000).toFixed(1)}K</div>
                                <div style="width: 55px; height: 8px; background-color: #10131c; border-radius: 10px;">
                                    <div style="width: ${((p2.totalDamageDealtToChampions / dealt).toFixed(2)) * 100}%; height: 100%; background-color: #e84057; border-radius: 10px;"></div>
                                </div>
                            </div>
                            <div class="column-lo" title="챔피언에게 받은 피해량">
                                <div style="font-size: 12px;">${(p2.totalDamageTaken/1000).toFixed(1)}K</div>
                                <div style="width: 55px; height: 8px; background-color: #10131c; border-radius: 10px;">
                                    <div style="width: ${((p2.totalDamageTaken / taken).toFixed(2)) * 100}%; height: 100%; background-color: dimgray; border-radius: 10px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="column-lo" style="min-width: 70px; max-width: 95px;">
                            <div class="row-lo" style="font-size: 13px;">
                                <div>${p2.kills}</div>
                                <div style="crimson: #b02a37">&nbsp;/&nbsp;${p2.deaths}&nbsp;/&nbsp;</div>
                                <div>${p2.assists}</div>
                            </div>
                            <div style="color: #808080; font-size: 12px">${((p2.kills+p2.assists)/Math.max(p2.deaths,1)).toFixed(2)}</div>
                            <div style="font-size: 13px;">${p2.totalMinionsKilled + p2.neutralMinionsKilled}&nbsp;(${((p2.totalMinionsKilled + p2.neutralMinionsKilled)/min).toFixed(1)})</div>
                        </div>
                        <div class="column-lo">
                            <div class="column-lo">
                                <div class="row-lo">
                                    ${generateDetailItem(p2.item0,p2.teamId)}
                                    ${generateDetailItem(p2.item1,p2.teamId)}
                                    ${generateDetailItem(p2.item2,p2.teamId)}
                                    ${generateDetailItem(p2.item6,p2.teamId)}
                                </div>
                                <div class="row-lo">
                                    ${generateDetailItem(p2.item3,p2.teamId)}
                                    ${generateDetailItem(p2.item4,p2.teamId)}
                                    ${generateDetailItem(p2.item5,p2.teamId)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            `);
        }

        info.push(`
                </div>
            `);
        // 배열에 있는 플레이어 정보를 문자열로 변환하여 반환
        return info.join('');

    }
    //빌드 생성
    async function generateBuild(matchId,tp) {
        const decodedTp = decodeURIComponent(tp);
        const targetParticipant = JSON.parse(decodedTp);
        const tpid = targetParticipant.puuid;
        const cn = targetParticipant.championName;
        const build = [];
        const minuteItemMap = {};
        const skillList = [];
        const evolveList = [];
        const skill = [];
        const stat = [5008, 5005, 5007, 5008, 5002, 5003, 5001, 5002, 5003];
        const primaryStyle = targetParticipant.perks.styles[0].selections;
        const subStyle = targetParticipant.perks.styles[1].selections;
        const ppi = primaryStyle.map(style => style.perk);
        const spi = subStyle.map(style => style.perk);
        const statP = [targetParticipant.perks.statPerks.offense,targetParticipant.perks.statPerks.flex,targetParticipant.perks.statPerks.defense];

        let pid=-1;

        try {
            const data = await callBuild(matchId);
            const champD = await fetchChampionData(cn);

            //데이터 처리
            data.info.participants.forEach(p =>{
                if (p.puuid == tpid){
                    pid = p.participantId;
                }
            })

            for (let i = 1;i<data.info.frames.length;i++){
                data.info.frames[i].events.forEach(e=>{
                    if (e.participantId == pid){
                        if (e.type == "ITEM_PURCHASED") {
                            const minute = Math.floor(e.timestamp / 60000);
                            if (!minuteItemMap[minute]) {
                                minuteItemMap[minute] = [];
                            }

                            // 해당 분 단위의 배열에 아이템 추가
                            minuteItemMap[minute].push(e);
                        }
                        else if (e.type == "SKILL_LEVEL_UP" && e.levelUpType == "NORMAL"){
                            skillList.push(e);
                        }
                        else if (e.type == "SKILL_LEVEL_UP" && e.levelUpType == "EVOLVE"){
                            evolveList.push(e);
                        }
                    }
                })
            }

            //HTML 삽입

            //아이템 빌드 시작
            build.push(`
                <div class="itemBuild">아이템 빌드</div>
            `);

            build.push(`<div class="row-lo itemDiv">`);

            const mins = Object.keys(minuteItemMap);
            const lastm = mins[mins.length-1];

            for(let i =0;i<4;i++){
                skill.push(champD.data[cn].spells[i].id);
            }

            // Assuming minuteItemMap is already defined and populated
            for (const minute in minuteItemMap) {
                build.push(`
                    <div class="column-lo" style="text-align: center; margin: 0px;">
                        <div class="row-lo" style="display: flex;justify-content: center;align-items: center">
                            <div class="row-lo" style="align-items: center; padding: 4px; background-color: #1c1c1f;border-radius: 10px;">

                `)

                minuteItemMap[minute].forEach(item => {
                    const itemImageSrc = `assets/img/item/${item.itemId}.png`;
                    build.push(`
                        <img loading='lazy' decoding='async' src='${itemImageSrc}' style='width: 30px; height: 30px; margin: 1.5px; overflow: hidden; border-radius: 10px;'>
                    `)
                });

                build.push(`
                            </div>
                `)

                if (minute != lastm){
                    build.push(`<div style="background-color: #1c1c1f; padding: 2px;"><img loading='lazy' decoding='async' src="assets/img/icon/icon-arrow.png" style="height: 15px; width: auto; color: white; margin: 3px;"></div>`);
                }

                build.push(`
                        </div>
                        <div style="font-size: 13px; font-weight: bold; text-align: left; margin-top: 3px; margin: 10px;">${minute}&nbsp;분</div>
                    </div>
                `)
            }

            build.push(`</div>`);
            //아이템 빌드 끝

            //스킬 빌드 시작
            build.push(`
                <div class="itemBuild">스킬 빌드</div>
            `);


            build.push(`<div class="column-lo itemDiv">`);

            build.push(`<div class="row-lo" style="padding: 10px;">`);
            build.push(`<div class="column-lo" style="width: 160px;">`);

            build.push(`<div style="font-weight: bold; text-align: left; padding-left: 10px; margin-bottom: 5px;">스킬 마스터</div>`);
            build.push(`<div class="row-lo" style="align-items: center;">`);


            const countMap = {};

            for (let i = 0;i<skillList.length;i++){
                let skillKey = ["Q", "W", "E"][skillList[i].skillSlot - 1] || "Unknown";
                const skillSlot = skillList[i].skillSlot;
                if (skillSlot == 4){
                    continue;
                }

                if (countMap[skillSlot]) {
                    countMap[skillSlot]++;
                    if (countMap[skillSlot] >= 5){
                        if (Object.keys(countMap).length<3){
                            build.push(`<div><img loading='lazy' decoding='async' src="assets/img/icon/icon-arrow.png" style="height: 15px; width: auto; color: white; margin: 3px;"></div>`);
                        }
                        build.push(`
                            <div style="align-items: center; padding: 4px; background-color: #1c1c1f;border-radius: 10px; position: relative;">
                                <img loading='lazy' decoding='async' src='${ddragon}${version}/img/spell/${skill[skillList[i].skillSlot-1]}.png' style="width: 30px;height: 30px; border-radius: 10px;">
                                <div style="text-align:center; position: absolute; right: 0px;bottom: 0px; font-size: 10px; background-color: black; border-radius: 5px; width: 17px; height: 17px;">${skillKey}</div>
                            </div>
                        `);
                        delete countMap[skillSlot];
                    }
                } else {
                    countMap[skillSlot] = 1;
                }
            }

            build.push(`</div>`);
            build.push(`</div>`);

            if (evolveList.length > 0){
                build.push(`<div class="column-lo" style="margin-left: 150px;">`);
                build.push(`<div style="font-weight: bold; text-align: left; padding-left: 10px; margin-bottom: 5px;">스킬 진화</div>`);
                build.push(`<div class="row-lo" style="align-items: center;">`);
                for (let i =0;i<evolveList.length;i++){
                    let skillKey = ["Q", "W", "E","R"][evolveList[i].skillSlot - 1] || "Unknown";
                    build.push(`
                            <div style="align-items: center; padding: 4px; background-color: #5f1c1f;border-radius: 10px; position: relative;">
                                <img loading='lazy' decoding='async' src='${ddragon}${version}/img/spell/${skill[evolveList[i].skillSlot-1]}.png' style="width: 30px;height: 30px; border-radius: 10px;">
                                <div style="text-align:center; position: absolute; right: 0px;bottom: 0px; font-size: 10px; background-color: black; border-radius: 5px; width: 17px; height: 17px;">${skillKey}</div>
                            </div>
                    `);
                    if (i+1 < evolveList.length){
                        build.push(`<div><img loading='lazy' decoding='async' src="assets/img/icon/icon-arrow.png" style="height: 15px; width: auto; color: white; margin: 3px;"></div>`);
                    }
                }
                build.push(`</div>`);
                build.push(`</div>`);
            }



            build.push(`</div>`);



            build.push(`<div class="row-lo skilldiv">`);

            for (let i = 0;i<skillList.length;i++){
                let skillKey = ["Q", "W", "E", "R"][skillList[i].skillSlot - 1] || "Unknown";
                build.push(`
                    <div class="row-lo" style="display: flex;justify-content: center;align-items: center;">
                        <div style="align-items: center; padding: 4px; background-color: #1c1c1f;border-radius: 10px; margin-bottom: 10px; position: relative;">
                            <img loading='lazy' decoding='async' src='${ddragon}${version}/img/spell/${skill[skillList[i].skillSlot-1]}.png' style="width: 30px;height: 30px; border-radius: 10px;">
                            <div style="text-align:center; position: absolute; right: 0px;bottom: 0px; font-size: 10px; background-color: black; border-radius: 5px; width: 17px; height: 17px;">${skillKey}</div>
                        </div>
                `)

                if (i != (skillList.length-1)){
                    build.push(`<div style="background-color: #1c1c1f; padding: 2px;"><img loading='lazy' decoding='async' src="assets/img/icon/icon-arrow.png" style="height: 15px; width: auto; color: white; margin: 3px;"></div>`);
                }

                build.push(`
                    </div>
                `)
            }
            build.push(`</div>`);
            build.push(`</div>`);
            //스킬 빌드 끝

            //룬 빌드 시작
            const runeData = await getRuneInfo();

            let mainRuneInfo = [];
            let mainRune;
            let subRuneInfo = [];
            let subRune;

            for (let i = 0; i <5;i++){
                if (runeData[i].id == targetParticipant.perks.styles[0].style){
                    mainRune = runeData[i].slots;
                    mainRuneInfo.push(runeData[i].icon);
                    mainRuneInfo.push(runeData[i].name);
                }
                else if (runeData[i].id == targetParticipant.perks.styles[1].style){
                    subRune = runeData[i].slots;
                    subRuneInfo.push(runeData[i].icon);
                    subRuneInfo.push(runeData[i].name);
                }
            }


            build.push(`
                <div class="itemBuild">룬 빌드</div>
            `);
            build.push(`<div class="row-lo itemDiv" style="display: flex; justify-content: space-between; padding: 10px;">`);
            build.push(`<div style="width: 30px;"></div>`);

            build.push(`
                    <div class="column-lo" style="min-width: 160px; height: auto;">
            `);

            for (let i = 0;i<mainRune.length;i++){
                if(i==0){
                    build.push(`
                    <div class="row-lo runeTitle"><img loading='lazy' decoding='async' src="assets/img/runes/${targetParticipant.perks.styles[0].style}.png" class="runeImg">&nbsp;${mainRuneInfo[1]}</div>
                    `);
                }
                build.push(`
                        <div class="row-lo" style="width: auto; display: flex;justify-content: space-between;align-items: center;">
                `);

                for (let j = 0;j<mainRune[i].runes.length;j++) {
                    if (ppi.includes(mainRune[i].runes[j].id)) {
                        build.push(`
                        <img loading='lazy' decoding='async' src="assets/img/runes/${mainRune[i].runes[j].id}.png" class="runeImg">
                        `);
                    }
                    else{
                        build.push(`
                        <img loading='lazy' decoding='async' src="assets/img/runes/${mainRune[i].runes[j].id}.png" class="runeImg" style="filter: grayscale(1)">
                        `);
                    }

                }
                build.push(`
                    </div>
                `);
            }
            build.push(`
                    </div>
            `);


            build.push(`
                    <div class="column-lo" style="min-width: 160px; height: auto;">
            `);

            for (let i = 1;i<subRune.length;i++){
                if(i==1){
                    build.push(`
                    <div class="row-lo runeTitle"><img loading='lazy' decoding='async' src="assets/img/runes/${targetParticipant.perks.styles[1].style}.png" class="runeImg">&nbsp;${subRuneInfo[1]}</div>
                    `);
                }

                build.push(`
                        <div class="row-lo" style="width: auto; display: flex;justify-content: space-between;align-items: center;">
                `);


                for (let j = 0;j<subRune[i].runes.length;j++) {
                    if (spi.includes(subRune[i].runes[j].id)) {
                        build.push(`
                        <img loading='lazy' decoding='async' src="assets/img/runes/${subRune[i].runes[j].id}.png" class="runeImg">
                        `);
                    }
                    else{
                        build.push(`
                        <img loading='lazy' decoding='async' src="assets/img/runes/${subRune[i].runes[j].id}.png" class="runeImg" style="filter: grayscale(1)">
                        `);
                    }

                }
                build.push(`
                    </div>
                `);
            }
            build.push(`
                    </div>
            `);

            /*5008 5005 5007
              5008 5002 5003
              5001 5002 5003*/

            build.push(`
                    <div class="column-lo" style="min-width: 140px; height: auto;">
            `);

            build.push(`<div class="row-lo runeTitle" style="height: 37px;">파편</div>`);


            for (let i  =0;i<3;i++){
                build.push(`<div class="row-lo" style="width: auto; display: flex;justify-content: space-between;align-items: center;">`);
                for (let j = 0;j<3;j++){
                    if (statP[i] == stat[i*3+j]){
                        build.push(`<img loading='lazy' decoding='async' src="assets/img/icon/${stat[i*3+j]}.png" class="runeImg">`);
                    }
                    else {
                        build.push(`<img loading='lazy' decoding='async' src="assets/img/icon/${stat[i*3+j]}.png" class="runeImg" style="filter: grayscale(1)">`);
                    }

                }
                build.push(`</div>`);
            }

            build.push(`</div>`);
            build.push(`<div style="width: 30px;"></div>`);
            build.push(`</div></div>`);
            //룬 빌드 끝

        } catch (error) {
            console.error('Error fetching data:', error);
            // Handle the error, e.g., return an error message
            build.push(`<div>Error: Unable to fetch data</div>`);
        }

        return build.join('');
    }
    //아이템 생성2
    function generateDetailItem(itemImageId,teamId){
        const itemslot = [];

        // 아이템 ID가 0인 경우에는 빈 칸으로 처리
        if (itemImageId !== 0) {
            const itemImageSrc = `assets/img/item/${itemImageId}.png`;
            itemslot.push(`
                <img loading='lazy' decoding='async' src='${itemImageSrc}' style='width: 22px; height: 22px; overflow: hidden; margin: 1px;'>
            `);
        } else {
            // 아이템 ID가 0인 경우, 빈 칸 추가
            const backgroundColor = teamId === 100 ? 'rgba(49, 142, 239, 0.2)' : 'rgba(244, 88, 78, 0.2)';
            itemslot.push(`
                <div style='width: 22px; height: 22px;background:${backgroundColor}; margin: 1px;'></div>
            `);
        }

        return itemslot.join('');
    }
    //솔로,자유랭크 생성
    function updateRankDisplay(rankData) {
        emblemElement.innerHTML = `<img loading='lazy' decoding='async' src="assets/img/emblem/${rankData.tier}.png" style='width: 100%; height: auto; object-fit: cover; border-radius: 10px;'>`;
        rankElement.textContent = rankData.rank;
        tierElement.textContent = rankData.tier;
        winsElement.textContent = `${rankData.wins}승 `;
        lossesElement.textContent = `${rankData.losses}패`;
    }
    // participants 배열 내에서 특정 아이디을 찾아 해당 객체를 반환하는 함수
    function findParticipantBySummonerId(summonerId, participants) {
        return participants.find(participant => participant.summonerId === summonerId);
    }
    //소환사 검색 함수
    function highlightInput() {
        const inputLabel = document.querySelector('.custom-input-box');
        inputLabel.style.borderColor = '#007bff';
    }
    function handleEnterKey(event) {
        if (event.key === 'Enter') {
            callApi();
        }
    }
    document.addEventListener('click', function(event) {
        const inputLabel = document.querySelector('.custom-input-box');
        if (!inputLabel.contains(event.target)) {
            inputLabel.style.borderColor = '#ccc';
        }
    });
    function callApi() {
        const inputValue = document.getElementById('inputValue').value;

        if (inputValue) {
            // 입력값을 컨트롤러로 전달하고 페이지 이동
            window.location.href = `/info?summonerName=${encodeURIComponent(inputValue)}`;
        }
    }
    //자릿수 변환
    function addCommasToNumber(number) {

        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    //추가정보 탭
    function toggleTab(mId,tId) {
        tabId = tId+mId
        const currentTab = document.getElementById(tabId);

        // 모든 탭 숨기기
        const tabs = currentTab.parentElement.parentElement.querySelectorAll('.tab-pane');
        for (const tab of tabs) {
            tab.classList.remove('active');
            tab.classList.add('hidden');
        }

        // 클릭된 탭 보이기
        currentTab.classList.remove('hidden');
        currentTab.classList.add('active');

        const outline = document.getElementById('detailOutline'+mId);
        const info = document.getElementById('detailInfo'+mId);
        const build = document.getElementById('detailBuild'+mId);

        if (tId == "tabOutline"){
            outline.classList.add('selected')
            info.classList.remove('selected')
            build.classList.remove('selected')
        }
        else if (tId == "tabInfo"){
            outline.classList.remove('selected')
            info.classList.add('selected')
            build.classList.remove('selected')
        }
        else if (tId == "tabBuild"){
            outline.classList.remove('selected')
            info.classList.remove('selected')
            build.classList.add('selected')
        }

    }
    //매치정보 찾기
    function findMatchById(matchId) {
        return matchData.find(match => match.metadata.matchId === matchId);
    }
    //각 정보에 맞는 요소 찾기
    function findHighestStatsPlayer(gameInfo) {

        const highestStats = {
            gameMode: {mode : '' },
            totalDamageDealt: {id:1,tag:'최다 딜량', value: -1, playerName: '', champion: '',teamPosition:'' },
            totalDamageTaken: {id:2,tag:'최다 피해량', value: -1, playerName: '', champion: '',teamPosition:'' },
            goldEarned: {id:3,tag:'최다 골드 획득', value: -1, playerName: '', champion: '',teamPosition:'' },
            kills: {id:4,tag:'최다 킬', value: -1, playerName: '', champion: '',teamPosition:'' },
            deaths: {id:5,tag:'최다 데스', value: -1, playerName: '', champion: '',teamPosition:'' },
            assists: {id:6,tag:'최다 어시스트', value: -1, playerName: '', champion: '',teamPosition:'' },
            turretKills: {id:7,tag:'철거왕', value: -1,tk: -1,ik: -1, playerName: '', champion: '',teamPosition:'' },
            save: {id:8,tag:'회복왕', value: -1, playerName: '', champion: '',teamPosition:'' },
            vision: {id:9,tag:'시야왕', value: -1,dp: -1,wp: -1, playerName: '', champion: '',teamPosition:'' },
            steal: {id:10,tag:'스틸왕', value: -1, playerName: '', champion: '',teamPosition:'' },
            wardsKilled: {id:11,tag:'와드 학살자', value: -1, playerName: '', champion: '',teamPosition:'' },
            totalMinionsKilled: {id:12,tag:'미니언 학살자', value: -1,min:-1, playerName: '', champion: '',teamPosition:'' }
        };

        highestStats.gameMode.mode = gameInfo.gameMode;

        gameInfo.participants.forEach(participant => {
            const totalDamageDealt = participant.totalDamageDealtToChampions + participant.trueDamageDealtToChampions;
            const totalstuc = participant.turretTakedowns + participant.inhibitorTakedowns;
            const save = participant.totalHealsOnTeammates + participant.totalDamageShieldedOnTeammates;

            //최대 딜량
            if (totalDamageDealt > highestStats.totalDamageDealt.value) {
                highestStats.totalDamageDealt.value = totalDamageDealt;
                highestStats.totalDamageDealt.playerName = participant.summonerName;
                highestStats.totalDamageDealt.champion = participant.championName;
                highestStats.totalDamageDealt.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //받은 피해량
            if (participant.totalDamageTaken > highestStats.totalDamageTaken.value) {
                highestStats.totalDamageTaken.value = participant.totalDamageTaken;
                highestStats.totalDamageTaken.playerName = participant.summonerName;
                highestStats.totalDamageTaken.champion = participant.championName;
                highestStats.totalDamageTaken.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //골드 획득량
            if (participant.goldEarned > highestStats.goldEarned.value) {
                highestStats.goldEarned.value = participant.goldEarned;
                highestStats.goldEarned.playerName = participant.summonerName;
                highestStats.goldEarned.champion = participant.championName;
                highestStats.goldEarned.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //킬
            if (participant.kills > highestStats.kills.value) {
                highestStats.kills.value = participant.kills;
                highestStats.kills.playerName = participant.summonerName;
                highestStats.kills.champion = participant.championName;
                highestStats.kills.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //데스
            if (participant.deaths > highestStats.deaths.value) {
                highestStats.deaths.value = participant.deaths;
                highestStats.deaths.playerName = participant.summonerName;
                highestStats.deaths.champion = participant.championName;
                highestStats.deaths.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //어시
            if (participant.assists > highestStats.assists.value) {
                highestStats.assists.value = participant.assists;
                highestStats.assists.playerName = participant.summonerName;
                highestStats.assists.champion = participant.championName;
                highestStats.assists.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //철거
            if (totalstuc > highestStats.turretKills.value) {
                highestStats.turretKills.value = totalstuc;
                highestStats.turretKills.tk = participant.turretTakedowns;
                highestStats.turretKills.ik = participant.inhibitorTakedowns
                highestStats.turretKills.playerName = participant.summonerName;
                highestStats.turretKills.champion = participant.championName;
                highestStats.turretKills.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //회복
            if (save > highestStats.save.value) {
                highestStats.save.value = save;
                highestStats.save.playerName = participant.summonerName;
                highestStats.save.champion = participant.championName;
                highestStats.save.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //시야
            if (participant.visionScore > highestStats.vision.value) {
                highestStats.vision.value = participant.visionScore;
                highestStats.vision.dp = participant.detectorWardsPlaced;
                highestStats.vision.wp = participant.wardsPlaced;
                highestStats.vision.playerName = participant.summonerName;
                highestStats.vision.champion = participant.championName;
                highestStats.vision.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //스틸
            if (participant.objectivesStolen > highestStats.steal.value) {
                highestStats.steal.value = participant.objectivesStolen;
                highestStats.steal.playerName = participant.summonerName;
                highestStats.steal.champion = participant.championName;
                highestStats.steal.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //와드
            if (participant.wardsKilled > highestStats.wardsKilled.value) {
                highestStats.wardsKilled.value = participant.wardsKilled;
                highestStats.wardsKilled.playerName = participant.summonerName;
                highestStats.wardsKilled.champion = participant.championName;
                highestStats.wardsKilled.teamPosition = participant.teamPosition || 'MIDDLE';
            }
            //미니언
            if (participant.totalMinionsKilled > highestStats.totalMinionsKilled.value) {
                const min = Math.floor(gameInfo.gameDuration / 60);
                highestStats.totalMinionsKilled.value = participant.totalMinionsKilled;
                highestStats.totalMinionsKilled.min = min;
                highestStats.totalMinionsKilled.playerName = participant.summonerName;
                highestStats.totalMinionsKilled.champion = participant.championName;
                highestStats.totalMinionsKilled.teamPosition = participant.teamPosition || 'MIDDLE';
            }

        });

        return highestStats;
    }
    //빌드 비동기 api요청
    const callBuild = async (matchId) => {
        try {
            const response = await fetch(apiUrl + "/timeline", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ matchId: matchId })
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error("API Error:", error);
            throw error;
        }
    }
    async function fetchChampionData(chamN) {
        const jsonUrl = `${ddragon}${version}/data/en_US/champion/${chamN}.json`;

        try {
            const response = await fetch(jsonUrl);

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error fetching data:', error);
            throw error; // Re-throw the error to be caught by the caller, if needed
        }
    }
    //룬정보 api요청
    async function getRuneInfo() {
        const jsonUrl = `https://ddragon.leagueoflegends.com/cdn/${version}/data/ko_KR/runesReforged.json`;

        try {
            const response = await fetch(jsonUrl);

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error fetching data:', error);
            throw error; // Re-throw the error to be caught by the caller, if needed
        }
    }
    //숙련도 비동기 api요청
    const callMastery = async (summonerName) => {
        try {
            const response = await fetch(apiUrl + "/mastery", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ summonerName: summonerName })
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error("API Error:", error);
            throw error;
        }
    }
/*    //솔로 랭크 요약 비동기 api요청
    const callSoloRating = async (summonerName) => {
        try {
            const response = await fetch(apiUrl + "/solo", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ summonerName: summonerName })
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error("API Error:", error);
            throw error;
        }
    }
    //자유 랭크 요약 비동기 api요청
    const callFlexRating = async (summonerName) => {
        try {
            const response = await fetch(apiUrl + "/flex", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ summonerName: summonerName })
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            return data;
        } catch (error) {
            console.error("API Error:", error);
            throw error;
        }
    }*/
    function sds(spid) {
        document.getElementById(spid).style.display='block';
    }
    function hds(spid) {
        document.getElementById(spid).style.display='none';
    }
    // JavaScript 함수 추가
    function toggleSide(tabId) {
        // 모든 탭 숨기기
        document.getElementById('soloSideTab').style.display = 'none';
        document.getElementById('flexSideTab').style.display = 'none';
        document.getElementById('soloSide').style.color = 'gray';
        document.getElementById('flexSide').style.color = 'gray';
        document.getElementById('soloSide').style.background = '#2c2c2f';
        document.getElementById('flexSide').style.background = '#2c2c2f';

        document.getElementById(tabId).style.background = '#393a3c';
        document.getElementById(tabId).style.color = 'white';
        // 클릭한 탭 보이기
        document.getElementById(tabId + 'Tab').style.display = 'block';
    }

    // 두 번째 함수 실행, 전적 리스트 생성
    async function callMatchHistory() {
        // URL에서 summonerName 쿼리 파라미터 값을 가져옴
        var summonerNameParam = new URLSearchParams(window.location.search).get("summonerName");
        // summonerName 요소가 존재하는지 확인
        if (summonerNameParam) {
            var userApiUrl = apiUrl + "/match"; // URL 파라미터를 제외한 URL

            try {
                const response = await fetch(userApiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ summonerName: summonerNameParam, index: matchIndex }) // 요청 데이터를 JSON 형식으로 전달
                });

                if (response.ok) {
                    const md = await response.json();
                    matchData.push(...md);
                } else {
                    throw new Error("MatchData Error: " + response.statusText);
                }
            } catch (error) {
                console.error(error);
            }
        }
    }
  </script>

</th:block>


</html>