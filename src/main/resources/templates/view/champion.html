<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<th:block layout:fragment="content">
  <style>
    #roleSelection {
      display: flex;
      align-items: center;
      width: 80%;
      justify-content: space-between;
    }
    .radio-label {
      position: relative;
      margin-right: 10px;
    }
    .radio-label input {
      position: absolute;
      opacity: 0;
      cursor: pointer;
    }
    .radio-label img {
      width: 35px;
      height: 35px;
      cursor: pointer;
    }
    .radio-label input:checked + img {
      filter: grayscale(0%);
    }
    .radio-label input:not(:checked) + img {
      filter: grayscale(100%);
    }

    .innerDiv{
      width: 1300px;
      display: flex;
      justify-content: space-between;
      align-items: start;
    }
    .searchBox{
      width: 380px;
      background-color: #2c2c2f;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
      border-radius: 10px;
    }
    .championInfoBox{
      width: 70%;
      border-radius: 10px;
      background-color: #2c2c2f;
      min-height: 1500px;
      display: flex;
      justify-content: start;
      align-items: center;
    }
    .champion-list{
      display: flex;
      width: 100%;
      min-height: 30px;
      flex-wrap: wrap;
      white-space: pre-wrap;
      justify-content: flex-start;
    }
    .noresult{
      width: 100%;
      height: 100px;
      font-size: 20px;
      color: gray;
      justify-content: center;
      align-items: center;
      text-align: center;
      margin: 0px;
    }

    #championDetails{
      width: 90%;
      margin-top: 25px;
    }

    .api-button {
      background-image: url('/assets/img/icon/icon-search.png');
      background-position: center;
      filter: invert(100%);
      background-size: contain;
      background-repeat: no-repeat;
      background-color: transparent;
      background-size: 25px auto;
      padding: 15px 15px;
      border: none;
      border-radius: 5px;
    }
    .input-field {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 5px;
      background-color: #1c1c1f;
      outline: none;
      width: 100%;
      height: 25px;
      font-size: 15px;
      color: white;
    }
    .custom-input-box {
      background-color: #1c1c1f;
      border: none;
      border-radius: 13px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      width: 100%;
      border: 3px solid #1c1c1f;
      transition: border-color 0.3s;
      margin: 0px 0px 10px 0px;
    }

    .champion-image {
      display: inline-block;
      margin: 4px;
      max-width: 52px;
      cursor: pointer;
    }
    .champion-image img {
      width: 52px;
      height: 52px;
      clip-path: inset(3px);
    }
    .champion-image.hidden {
      display: none;
    }
    .champion-image:hover{
      transform: scale(1.1); /* 마우스를 올렸을 때 크기를 확대합니다. */
    }
    .champion-name{
      text-align: center;
      font-size: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap
    }

    .spinner {
      border: 3px solid #f3f3f3; /* Light grey */
      border-top: 3px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin-right: 10px;
      display: none;
    }
    .input-field2 {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 5px;
      background-color: #f5f5f5;
      outline: none;
      width: 100%;
      height: 95%;
      font-size: 15px;
    }
    .api-button2 {
      background-image: url('/assets/img/icon/icon-search.png');
      background-position: center;
      background-size: contain;
      background-repeat: no-repeat;
      background-color: transparent;
      background-size: 25px auto;
      padding: 15px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .custom-input-box2 {
      background-color: #f5f5f5;
      border: none;
      border-radius: 13px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      width: 850px;
      height: 35px;
      padding: 10px;
      border: 3px solid #ccc;
      transition: border-color 0.3s;
      margin: 20px;
    }

    #laneDataTab{
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .infoImg{
      width: 115px;
      height: 115px;
      clip-path: inset(5px round 10px);
    }

    .infoPosition{
      min-width: 55px;
      min-height: 62px;
      margin: 5px;
      display: flex;
      align-items: center;
      text-align: center;
      justify-content: center;
      cursor: pointer;
    }
    .infoPosition:hover{
      transform: scale(1.1); /* 마우스를 올렸을 때 크기를 확대합니다. */
    }
    .infoPositionImg{
      width: 40px;
      height: 40px;
      filter: grayscale(100%);
    }

    .dataShowTab{
      background-color: #31313c;
      min-height: 500px;
      margin-top: -65px;
      width: 100%;
      border-radius: 13px;
    }
    .skinImg{
      width: 150px;
      height: auto;
      clip-path: inset(5px round 10px);
    }

    .slider-container {
      width: 774px;
      background-color: #1c1c1f;
      padding-left: 2px;
      padding-right: 2px;
      border-radius: 13px;
      display: flex;
      margin: 5px;
      justify-content: start;
      align-items: center;
      overflow: hidden;
    }
    .slider {
      width: 100%;
      height: 100%;
      display: flex;
      transition: transform 0.5s ease-in-out;
    }
    .slide {
      margin: 2px;
      height: 305px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    .skinBtn{
      margin: 2px;
      cursor: pointer;
    }
    .skinBtnImg{
      width: 20px;
      height: 20px;
    }
    .runeImg{
      width: 30px;
      height: 30px;
      margin: 3px;
    }
    .buildTab{
      width: 774px;
      margin: 5px;
      background-color: #1c1c1f;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 13px;
    }
    .buildComb{
      width: 90%;
      min-height: 110px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px;
    }

    #graphTab{
      width: 90%;
      min-height: 110px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 10px;
    }
  </style>

  <div class="main-box bg-dark">
    <div>
      <label class="custom-input-box2">
        <input type="text" id="inputValue2" class="input-field2" placeholder="라이엇 ID와 태그를 입력해주세요. ( ex. hide on bush #kr1 )" onkeydown="handleEnterKey(event)" onclick="highlightInput()">
        <div onclick="callApi()" class="api-button2"></div>
      </label>
    </div>
    <div class="row-lo innerDiv">
      <div class="column-lo searchBox">
        <label class="custom-input-box">
          <div class="api-button"></div>
          <input type="text" id="inputValue" class="input-field" placeholder="챔피언 이름을 입력해주세요." autofocus="autofocus" onkeyup="searchChampion()">
        </label>
        <div id="roleSelection">
          <label class="radio-label">
            <input type="radio" name="role" value="A" checked="checked" onclick="searchChampion()">
            <img class="positionImg" src="assets/img/position/FILL.png" alt="전체">
          </label>
          <label class="radio-label">
            <input type="radio" name="role" value="T" onclick="searchChampion()">
            <img class="positionImg" src="assets/img/position/TOP.png" alt="탑">
          </label>
          <label class="radio-label">
            <input type="radio" name="role" value="J" onclick="searchChampion()">
            <img class="positionImg" src="assets/img/position/JUNGLE.png" alt="정글">
          </label>
          <label class="radio-label">
            <input type="radio" name="role" value="M" onclick="searchChampion()">
            <img class="positionImg" src="assets/img/position/MIDDLE.png" alt="미드">
          </label>
          <label class="radio-label">
            <input type="radio" name="role" value="B" onclick="searchChampion()">
            <img class="positionImg" src="assets/img/position/BOTTOM.png" alt="바텀">
          </label>
          <label class="radio-label">
            <input type="radio" name="role" value="U" onclick="searchChampion()">
            <img class="positionImg" src="assets/img/position/UTILITY.png" alt="서폿">
          </label>
        </div>
        <div id="championList" class="champion-list">
        </div>
        <div class="column-lo noresult" id="noresult" style="display: none;">
          <img style="color:gray;" src="assets/img/icon/noresult.png">
          <div style="color: gray; font-weight: bold; font-size: 17px;">No Result!</div>
        </div>
      </div>
      <div class="column-lo championInfoBox">
          <div class="column-lo" id="championDetails">

          </div>
      </div>
    </div>

  </div>

<!--  <div class="spinner" id="sp1"></div>-->
  <script>
    let championsData = [];
    let currentIndex = 5;
    let positionDistance = 0;

    // 페이지가 로드되면 실행되는 함수
    document.addEventListener("DOMContentLoaded", async function() {
      championsData = await callChampion();
      // Display Korean champion names initially
      inputChampion();
    });

    //챔피언 검색 함수
    async function searchChampion() {
      const inputValue = document.getElementById('inputValue').value.toLowerCase(); // 입력된 검색어 가져오기
      const selectedRole = document.querySelector('input[name="role"]:checked').value; // 선택된 라디오 버튼 값 가져오기

      const data = await callChampionWithOptions(inputValue,selectedRole);
      championsData = data;
      displayChampionList();

    }
    //검색된 챔피언 display함수
    function displayChampionList() {
      document.getElementById("noresult").style.display = "none";
      // 모든 챔피언 이미지 숨김
      const championImages = document.querySelectorAll('.champion-image');
      championImages.forEach(imageDiv => imageDiv.classList.add('hidden'));

      if (championsData.length>0){
        // 검색된 챔피언 이미지만 표시
        championsData.forEach(champion => {
          const championImage = document.querySelector(`img[alt="c${champion.championId}"]`);
          if (championImage) {
            const parentDiv = championImage.parentElement;
            parentDiv.classList.remove('hidden');
          }
        });
      }else {
        document.getElementById("noresult").style.display = "block";
      }

    }

    //검색된 챔피언 display함수
    function inputChampion() {

      const championList = document.getElementById('championList');

      for (let i = 0; i < championsData.length; i++) {
        const championImageDiv = document.createElement('div');
        championImageDiv.classList.add('champion-image');

        const img = document.createElement('img');
        img.src = `assets/img/champion/${championsData[i].championName}.png`;
        img.id = `${championsData[i].championName}`
        img.alt = `c${championsData[i].championId}`;

        const nameDiv = document.createElement('div');
        nameDiv.classList.add('champion-name');
        nameDiv.textContent = championsData[i].championNameKr;  // 챔피언 이름 설정

        championImageDiv.addEventListener('click',function (){
          showChampionInfo(img.id)
        })

        championImageDiv.appendChild(img);
        championImageDiv.appendChild(nameDiv);
        championList.appendChild(championImageDiv);
      }
    }

    async function showChampionInfo(champName){
      let name = champName
      if (name == 'FiddleSticks'){
        name = 'Fiddlesticks'
      }
      const championInfo = await callChampionInfo(name);
      const infoData = championInfo['data'][name]
      const dataSet = await callDataset(champName);
      console.log(infoData)
      console.log(dataSet)

      let played = 0;
      let defaultLane = null;
      for (let i  = 0;i<dataSet.length;i++){
        let temp = dataSet[i]['win'] + dataSet[i]['lose'];
        if (played<temp){
          played = temp;
          defaultLane = dataSet[i]['teamPosition'];
        }
      }

      const infoBox = document.getElementById("championDetails");
      infoBox.removeChild(infoBox.firstChild);
      currentIndex=5;
      positionDistance = 0;

      let totalGameCount = 0;

      for (let i = 0; i < dataSet.length; i++) {
        totalGameCount+=dataSet[i]['win'];
        totalGameCount+=dataSet[i]['lose'];
      }

      let pickrateList = [0.0, 0.0, 0.0, 0.0, 0.0];

      for (let i = 0; i < dataSet.length; i++) {
        const gameCountRate = (((dataSet[i]["win"] + dataSet[i]["lose"]) / totalGameCount) * 100).toFixed(2);

        switch (dataSet[i]["teamPosition"]) {
          case "TOP":
            pickrateList[0] = parseFloat(gameCountRate);
            break;
          case "JUNGLE":
            pickrateList[1] = parseFloat(gameCountRate);
            break;
          case "MIDDLE":
            pickrateList[2] = parseFloat(gameCountRate);
            break;
          case "BOTTOM":
            pickrateList[3] = parseFloat(gameCountRate);
            break;
          case "UTILITY":
            pickrateList[4] = parseFloat(gameCountRate);
            break;
          default:
            // 다른 포지션에 대한 처리가 필요하다면 추가하세요.
            break;
        }
      }
      // 출력 시 "50.00%" 형식으로 변환
      const formattedPickrateList = pickrateList.map(gameCountRate => gameCountRate.toFixed(2) + "%");

      infoBox.innerHTML = `
            <div class="column-lo" style="width: 100%; display: flex;align-items: center; justify-content: center">
                <div class="row-lo" style="width: 95%;">
                    <img src="assets/img/champion/${champName}.png" class="infoImg">
                    <div class="column-lo">
                        <div class="row-lo" style="justify-content: center; text-align: center; padding-top: 10px; margin-left: 15px;">
                            <div style="font-size: 24px; font-weight: bold; font-style: oblique;">${infoData['name']}&nbsp;&nbsp;</div>
                            <div style="font-size: 20px; color: darkgray; padding: 3px; font-style: oblique;">${infoData['title']}</div>
                        </div>
                    </div>
                </div>
                <div class="column-lo dataShowTab">
                   <div class="row-lo" style="margin-left: 145px;">
                      <div class="column-lo infoPosition" onclick="showDatasetEachLane('${name}','TOP')">
                          <img class="infoPositionImg" src="assets/img/position/TOP.png" id="TOPBtn">
                          <div style="font-size: 14px;">${formattedPickrateList[0]}</div>
                      </div>
                      <div class="column-lo infoPosition" onclick="showDatasetEachLane('${name}','JUNGLE')">
                          <img class="infoPositionImg" src="assets/img/position/JUNGLE.png" id="JUNGLEBtn">
                          <div style="font-size: 14px;">${formattedPickrateList[1]}</div>
                      </div>
                      <div class="column-lo infoPosition" onclick="showDatasetEachLane('${name}','MIDDLE')">
                          <img class="infoPositionImg" src="assets/img/position/MIDDLE.png" id="MIDDLEBtn">
                          <div style="font-size: 14px;">${formattedPickrateList[2]}</div>
                      </div>
                      <div class="column-lo infoPosition" onclick="showDatasetEachLane('${name}','BOTTOM')">
                          <img class="infoPositionImg" src="assets/img/position/BOTTOM.png" id="BOTTOMBtn">
                          <div style="font-size: 14px;">${formattedPickrateList[3]}</div>
                      </div>
                      <div class="column-lo infoPosition" onclick="showDatasetEachLane('${name}','UTILITY')">
                          <img class="infoPositionImg" src="assets/img/position/UTILITY.png" id="UTILITYBtn">
                          <div style="font-size: 14px;">${formattedPickrateList[4]}</div>
                      </div>
                  </div>
                  <div class="column-lo" id="laneDataTab">

                  </div>
                  <div class="column-lo" style="display: none; width: 100%;" id="noDataTab">
                    <div class="column-lo" style="width: 100%; height: 400px; display: flex; justify-content: center; align-items: center;">
                        <div style="font-size: 20px; font-weight: bold;">통계 자료가 부족합니다!</div>
                        <div><img src="assets/img/icon/rip.png" style="width: 250px;"></div>
                    </div>
                  </div>
                  <div class="column-lo" style="display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                    ${generateSkins(infoData['skins'],name,infoData["name"])}
                  </div>
                </div>
            </div>
        `;

      showDatasetEachLane(name,defaultLane);
    }

    async function showDatasetEachLane(cn,lane) {
      const laneData = await callDataset2(cn,lane)
      updateLaneStyles(lane);
      const lanetab = document.getElementById("laneDataTab");
      lanetab.innerHTML = "";
      console.log(laneData);

      if (laneData["championName"] == null){
        document.getElementById("noDataTab").style.display = "block";
      }
      else {

        const mr = convertStringToArray(laneData['mr']);
        const sr = convertStringToArray(laneData['sr']);
        const fr = convertStringToArray(laneData['fragment']);
        const spell = convertStringToArray(laneData['spell']);
        const timeS = Object.entries(JSON.parse(laneData['timeS'].replace(/'/g, '"')));
        const shoes = (JSON.parse(laneData['shoes'].replace(/'/g, '"'))).map(item => [parseInt(item[0]), item[1]]);

        const skev = eval(laneData['skevole']);
        const skill = eval(laneData['skill']);

        const si = eval(laneData['startItems']);
        const core1 = eval(laneData['core1']);
        const core2 = eval(laneData['core2']);
        const core3 = eval(laneData['core3']);
        const core4 = eval(laneData['core4']);




        let heightsize = 30*mr.length;

        document.getElementById("noDataTab").style.display = "none";

        lanetab.innerHTML = `
          <div class="column-lo" id="summaryTab">

          </div>
          <div class="column-lo buildTab">
            <div class="row-lo" style="display: flex;justify-content: space-between; width: 90%">
                <div style="font-weight: bold;font-size: 16px; margin: 7px;">시간대별 승률</div>
                <div style="font-weight: bold;font-size: 16px; margin: 7px;">${laneData['win']}&nbsp;승&nbsp;&nbsp;${laneData['lose']}&nbsp;패</div>
            </div>

            <div style="width: 90%; height: 2px; background: #2c2c2f;"></div>
            <div class="row-lo" id="graphTab">
            </div>
          </div>
          <div class="column-lo buildTab">
            <div style="width: 90%;text-align: left; font-weight: bold;font-size: 16px; margin: 7px;">스펠, 시작 아이템 선택</div>
            <div style="width: 90%; height: 2px; background: #2c2c2f;"></div>
            <div class="row-lo buildComb">
                    ${generateSpell(spell)}
                    <div style="width: 1px; height: ${heightsize}px; background: #2c2c2f;"></div>
                    ${generateSI(si)}
                    <div style="width: 1px; height: ${heightsize}px; background: #2c2c2f;"></div>
                    ${generateShoes(shoes)}
            </div>
          </div>
          <div class="column-lo buildTab">
            <div style="width: 90%;text-align: left; font-weight: bold;font-size: 16px; margin: 7px;">코어 아이템 조합 (구매 순서)</div>
            <div style="width: 90%; height: 2px; background: #2c2c2f;"></div>
            <div class="row-lo buildComb">
                    ${generateCore(core2,2)}
                    <div style="width: 1px; height: ${heightsize}px; background: #2c2c2f;"></div>
                    ${generateCore(core3,3)}
                    <div style="width: 1px; height: ${heightsize}px; background: #2c2c2f;"></div>
                    ${generateCore(core4,4)}
            </div>
          </div>
          <div class="column-lo buildTab">
            <div style="width: 90%;text-align: left; font-weight: bold;font-size: 16px; margin: 7px;">룬 조합</div>
            <div style="width: 90%; height: 2px; background: #2c2c2f;"></div>
            <div class="row-lo buildComb">
                    ${generateMrComb(mr)}
                    <div style="width: 1px; height: ${heightsize}px; background: #2c2c2f;"></div>
                    ${generateSrComb(sr)}
                    <div style="width: 1px; height: ${heightsize}px; background: #2c2c2f;"></div>
                    ${generateFrComb(fr)}
            </div>
          </div>


        `;

        // Append the chart element
        const graphTab = document.getElementById("graphTab");
        const chartElement = generateGraph(timeS);
        graphTab.appendChild(chartElement);
      }
    }

    //스킨 탭 생성
    function generateSkins(skins,cn,name){
      const skin = []

      skin.push(`
        <div class="column-lo slider-container">
          <div class="row-lo" style="width: 95%; display:flex; justify-content: space-between; margin-top: 10px; margin-bottom: 10px;">
              <div style="font-size: 16px;">${name}&nbsp;스킨</div>
              <div class="row-lo">
                <div class="skinBtn" onclick="slideLeft()"><img class="skinBtnImg" src="assets/img/icon/left.png"></div>
                <div style="width: 20px;"></div>
                <div class="skinBtn" onclick="slideRight('${skins.length}')"><img class="skinBtnImg" src="assets/img/icon/right.png"></div>
              </div>
          </div>
          <div style="width: 95%; height: 2px; background: #2c2c2f; margin-top: 5px; margin-bottom: 20px;"></div>
        <div class="row-lo slider" id="slider">

      `)

      for (let i = 0;i<skins.length;i++){
        skin.push(`
            <div class="column-lo slide">
                <img class="skinImg" src="${ddragon}img/champion/loading/${cn}_${skins[i]["num"]}.jpg">
                <div style="font-size: 14px; min-height: 43px; margin-bottom: 10px;">${i === 0 ? name : skins[i]["name"].replace(name, `<br>${name}`)}</div>
            </div>
        `)
      }

      skin.push(`
        </div>
        </div>
      `)

      return skin.join('');
    }
    //룬 탭 생성
    function generateMrComb(mr){
      const rc = []
      rc.push(`<div class="column-lo">`);
      for (let i = 0;i<mr.length;i++){
        rc.push(`
          <div class="row-lo">
            <div><img class="runeImg" src="assets/img/runes/${mr[i][0][0]}.png"></div>
            <div><img class="runeImg" src="assets/img/runes/${mr[i][0][1]}.png"></div>
            <div><img class="runeImg" src="assets/img/runes/${mr[i][0][2]}.png"></div>
            <div><img class="runeImg" src="assets/img/runes/${mr[i][0][3]}.png"></div>
            <div><img class="runeImg" src="assets/img/runes/${mr[i][0][4]}.png"></div>
            <div style="min-width: 60px; text-align: right; line-height: 36px;">${mr[i][1]} 회</div>
          </div>
        `);
      }

      rc.push(`</div>`);
      return rc.join('');
    }
    function generateSrComb(sr){
      const rc = []
      rc.push(`<div class="column-lo">`);
      for (let i = 0;i<sr.length;i++){
        rc.push(`
          <div class="row-lo">
            <div><img class="runeImg" src="assets/img/runes/${sr[i][0][0]}.png"></div>
            <div><img class="runeImg" src="assets/img/runes/${sr[i][0][1]}.png"></div>
            <div><img class="runeImg" src="assets/img/runes/${sr[i][0][2]}.png"></div>
            <div style="min-width: 60px; text-align: right; line-height: 36px;">${sr[i][1]} 회</div>
          </div>
        `);
      }

      rc.push(`</div>`);
      return rc.join('');
    }
    function generateFrComb(fr){
      const rc = []
      rc.push(`<div class="column-lo">`);
      for (let i = 0;i<fr.length;i++){
        rc.push(`
          <div class="row-lo">
            <div><img class="runeImg" src="assets/img/icon/${fr[i][0][0]}.png"></div>
            <div><img class="runeImg" src="assets/img/icon/${fr[i][0][1]}.png"></div>
            <div><img class="runeImg" src="assets/img/icon/${fr[i][0][2]}.png"></div>
            <div style="min-width: 60px; text-align: right; line-height: 36px;">${fr[i][1]} 회</div>
          </div>
        `);
      }

      rc.push(`</div>`);
      return rc.join('');
    }
    //코어 아이템 탭 생성
    function generateCore(cr,count){
      const rc = []
      rc.push(`<div class="column-lo">`);
      for (let i = 0;i<cr.length;i++){

        const itemList = cr[i][0].split(", ")

        rc.push(`
          <div class="row-lo">

        `);

        for (let j=0;j<count;j++){
          rc.push(`
            <div><img class="runeImg" src="assets/img/item/${itemList[j]}.png"></div>
        `);
        }

        rc.push(`
            <div style="min-width: 60px; text-align: right; line-height: 36px;">${cr[i][1]} 회</div>
          </div>
        `);
      }

      rc.push(`</div>`);
      return rc.join('');
    }
    //소환사 주문 탭 생성
    function generateSpell(sp){
      const rc = []
      rc.push(`<div class="column-lo">`);
      for (let i = 0;i<sp.length;i++){
        rc.push(`
          <div class="row-lo">
            <div><img class="runeImg" src="assets/img/spell/${sp[i][0][0]}.png"></div>
            <div><img class="runeImg" src="assets/img/spell/${sp[i][0][1]}.png"></div>
            <div style="min-width: 60px; text-align: right; line-height: 36px;">${sp[i][1]} 회</div>
          </div>
        `);
      }

      rc.push(`</div>`);
      return rc.join('');
    }
    //시작아이템 탭 생성
    function generateSI(si){
      const rc = []
      rc.push(`<div class="column-lo">`);
      for (let i = 0;i<si.length;i++){

        var sil = (si[i][0].slice(1,-1)).split(", ");
        console.log(sil)

        rc.push(`
          <div class="row-lo">
            <div class="row-lo" style="min-width: 120px;">
        `);

        for (let j=0;j<sil.length;j++){
          rc.push(`
            <div><img class="runeImg" src="assets/img/item/${sil[j]}.png"></div>
        `);
        }

        rc.push(`
            </div>
            <div style="min-width: 60px; text-align: right; line-height: 36px;">${si[i][1]} 회</div>
          </div>
        `);

      }

      rc.push(`</div>`);
      return rc.join('');
    }
    //신발 탭 생성
    function generateShoes(shoes){
      const rc = []
      rc.push(`<div class="column-lo">`);
      for (let i = 0;i<2;i++){
        if (!isNaN(shoes[i][0])){
          rc.push(`
          <div class="row-lo">
            <div><img class="runeImg" src="assets/img/item/${shoes[i][0]}.png"></div>
            <div style="min-width: 60px; text-align: right; line-height: 36px;">${shoes[i][1]} 회</div>
          </div>
        `);
        }

      }

      rc.push(`</div>`);
      return rc.join('');
    }
    //시간대별 승률 그래프 탭 생성
    function generateGraph(timeS) {
      const timePoints = timeS.map(([time]) => time);
      var winRates = [];

      for (let i = 0; i < timeS.length; i++) {
        const totalGames = timeS[i][1][0] + timeS[i][1][1];
        const winPercentage = (timeS[i][1][0] / totalGames * 100).toFixed(2);

        const parsedWinRate = parseFloat(winPercentage);

        // Check if the parsedWinRate is a valid number and not equal to 0 or NaN
        if (!isNaN(parsedWinRate) && parsedWinRate !== 0) {
          winRates.push(parsedWinRate);
        }
      }
      console.log(timePoints);
      console.log(winRates);

      // Create canvas element
      const canvas = document.createElement('canvas');
      canvas.width = 650;
      canvas.height = 300;

      // Get canvas context
      const ctx = canvas.getContext('2d');

      // Plot the chart using Chart.js
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [{
            label: '시간대별 승률 그래프',
            borderColor: 'yellow',
            data: winRates,
            fill: false,
          }]
        },
        options: {
          responsive: false,
          scales: {
            x: {
              title: {
                display: true,
                text: '시간대 (분)'
              },
              ticks: {
                color: 'white', // x축 눈금 색상
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)' // 추가: 그리드 눈금 색상
              },
            },
            y: {
              title: {
                display: true,
                text: '승률 (%)'
              },
              ticks: {
                color: 'white', // x축 눈금 색상
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)' // 추가: 그리드 눈금 색상
              },
            }
          }
        }
      });

      // Return the canvas element
      return canvas;
    }


    //이미지 슬라이드 함수
    function slideLeft() {
      if (currentIndex > 5) {
        currentIndex--;
        updateSlider(1);
      }
    }
    function slideRight(len) {
      if (currentIndex < len) {
        currentIndex++;
        updateSlider(-1);
      }
    }
    function updateSlider(vector) {
      const imageList = document.getElementById("slider")
      positionDistance += vector*154;
      imageList.style.transform = `translateX(${positionDistance}px)`;
    }

    //통계 데이터 전처리
    function convertStringToArray(inputString) {
      // 문자열을 파싱하여 데이터 추출
      const extractedData = JSON.parse(inputString
              .replace(/\(/g, '[')
              .replace(/\)/g, ']')
              .replace(/(\d+),/g, '$1,')
              .replace(/(\d+)\]/g, '$1]')
      );

      // 추출된 데이터를 이용하여 배열 생성
      const resultArray = extractedData.map(item => [item[0], item[1]]);

      return resultArray;
    }
    //선택 라인 grayscale조정
    function updateLaneStyles(selectedLane) {
      const lanes = ["TOP", "JUNGLE", "MIDDLE", "BOTTOM", "UTILITY"];

      lanes.forEach(lane => {
        const element = document.getElementById(lane+"Btn");

        if (lane === selectedLane) {
          element.style.filter = "grayscale(0%)";
        } else {
          element.style.filter = "grayscale(100%)";
        }
      });
    }
    //숙련도 비동기 api요청
    const callChampion = async () => {
      try {
        const response = await fetch(apiUrl + "/champion", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({})
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        return data;
      } catch (error) {
        console.error("API Error:", error);
        throw error;
      }
    }
    //숙련도 비동기 api요청
    const callChampionWithOptions = async (inputValue,selectedRole) => {
      try {
        const response = await fetch(apiUrl + "/champion2", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ inputValue: inputValue,selectedRole: selectedRole})
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        return data;
      } catch (error) {
        console.error("API Error:", error);
        throw error;
      }
    }
    function sds(spid) {
      document.getElementById(spid).style.display='block';
    }
    function hds(spid) {
      document.getElementById(spid).style.display='none';
    }

    //소환사 검색 함수
    function highlightInput() {
      const inputLabel = document.querySelector('.custom-input-box');
      inputLabel.style.borderColor = '#007bff';
    }
    function handleEnterKey(event) {
      if (event.key === 'Enter') {
        callApi();
      }
    }
    document.addEventListener('click', function(event) {
      const inputLabel = document.querySelector('.custom-input-box');
      if (!inputLabel.contains(event.target)) {
        inputLabel.style.borderColor = '#1c1c1f';
      }
    });

    function callApi() {
      const inputValue = document.getElementById('inputValue2').value;

      if (inputValue) {
        // 입력값을 컨트롤러로 전달하고 페이지 이동
        window.location.href = `/info?summonerName=${encodeURIComponent(inputValue)}`;
      }
    }

    //챔피언 정보 api요청
    async function callChampionInfo(cname) {
      const jsonUrl = `${ddragon}${version}/data/ko_KR/champion/${cname}.json`;

      try {
        const response = await fetch(jsonUrl);

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching data:', error);
        throw error; // Re-throw the error to be caught by the caller, if needed
      }
    }
    //통계 비동기 api요청
    const callDataset = async (cn) => {
      try {
        const response = await fetch(apiUrl + "/dataset", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ championName: cn })
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        return data;
      } catch (error) {
        console.error("API Error:", error);
        throw error;
      }
    }
    const callDataset2 = async (cn,lane) => {
      try {
        const response = await fetch(apiUrl + "/dataset2", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ championName: cn, lane:lane })
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        return data;
      } catch (error) {
        console.error("API Error:", error);
        throw error;
      }
    }

    //룬정보 api요청
    async function getRuneInfo() {
      const jsonUrl = `https://ddragon.leagueoflegends.com/cdn/${version}/data/ko_KR/runesReforged.json`;

      try {
        const response = await fetch(jsonUrl);

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching data:', error);
        throw error; // Re-throw the error to be caught by the caller, if needed
      }
    }
  </script>

</th:block>


</html>